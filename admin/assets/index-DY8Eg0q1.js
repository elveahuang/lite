var W=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var L=(e,t,n)=>t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,c=(e,t)=>{for(var n in t||(t={}))v.call(t,n)&&L(e,n,t[n]);if(R)for(var n of R(t))ee.call(t,n)&&L(e,n,t[n]);return e},d=(e,t)=>Y(e,Z(t));var l=(e,t,n)=>new Promise((b,k)=>{var F=r=>{try{h(n.next(r))}catch(f){k(f)}},i=r=>{try{h(n.throw(r))}catch(f){k(f)}},h=r=>r.done?b(r.value):Promise.resolve(r.value).then(F,i);h((n=n.apply(e,t)).next())});import{as as p,X as se,j as s,ay as V,a3 as u,a2 as C,r as m,a7 as te,az as ne,aA as ae,aB as oe,aD as w,a1 as M,aE as O}from"./index-CImqLPgG.js";import{P as re,u as le,a as ie,M as q,b as ce,s as me}from"./data-table-ekLqW_zJ.js";import{F as _}from"./index-DyWQD6aF.js";const de=e=>p("/api/admin/user/list",e),B=e=>p("/api/admin/user/details",e),ue=e=>p("/api/admin/user/save",e),_e=e=>p("/api/admin/user/delete",e),he=e=>p("/api/user/check/username",e),fe=e=>!!e&&e.constructor===Symbol,pe=e=>!!(e&&e.constructor&&e.call&&e.apply),be=e=>S(e)&&e%1===0,S=e=>{try{return Number(e)===e}catch(t){return!1}},xe=e=>Object.prototype.toString.call(e)==="[object Date]",je=e=>{if(e===!0||e===!1||e==null)return!0;if(S(e))return e===0;if(xe(e))return isNaN(e.getTime());if(pe(e)||fe(e))return!1;const t=e.length;if(S(t))return t===0;const n=e.size;return S(n)?n===0:Object.keys(e).length===0},ye=(b,k,...F)=>l(void 0,[b,k,...F],function*(e,t,n={}){if(!je(t)){const i=yield he({username:t,id:n.id||0});if(i.code===200&&i.data===!0)return Promise.resolve()}return Promise.reject(new Error(e.message))}),Fe=()=>{const{t:e}=se(),{initialize:t,handleResult:n,handleParams:b}=ce(),F={columns:[{key:"username",dataIndex:"username",title:e("common:user_field_username")},{key:"operations",dataIndex:"id",title:e("common:label_action"),width:"200px",render:(a,o,g)=>s.jsxs(V,{children:[s.jsx(u,{size:"small",icon:s.jsx(C,{icon:"mdi:eye-outline"}),onClick:()=>{alert(o.id),Q(o.id).then()}}),s.jsx(u,{size:"small",icon:s.jsx(C,{icon:"ant-design:edit-outlined"}),onClick:()=>{z(o.id).then()}}),s.jsx(re,{title:e("common:label_confirm_delete_record"),description:e("common:label_confirm_delete_record"),onConfirm:()=>{I(o.id).then()},onCancel:()=>{},children:s.jsx(u,{size:"small",danger:!0,icon:s.jsx(C,{icon:"ant-design:close-outlined"})})})]})}]},[i,h]=m.useState(t(F)),[r,{toggle:f}]=le(!1),x=m.useRef(),U=()=>l(void 0,null,function*(){me(i,!0),yield de(b(i)).then(a=>{h(n(i,a))})}),I=(a=0)=>l(void 0,null,function*(){console.log(a),console.log(be(a));const o=a?[a]:x.current.getSelectedRowKeys();if(console.log(o),te(o)){ne(e("common:label_please_select_one_record")).then();return}_e({ids:o}).then(g=>{g.code=="200"&&x.current.refresh()})}),[G,j]=m.useState(!1),[H,E]=m.useState(""),[y,D]=m.useState({}),[P]=_.useForm(),z=(a=0)=>l(void 0,null,function*(){a&&a>0?(E(e("common:user_pages_edit_title")),yield B({id:a}).then(o=>{D(Object.assign(y,c({},o.data)))}),j(!0)):(E(e("common:user_pages_add_title")),D(Object.assign(y,{status:0})),j(!0))}),K=()=>l(void 0,null,function*(){P.validateFields().then(a=>l(void 0,null,function*(){yield ue(a).then(o=>{o.code=="200"&&(j(!1),x.current.refresh())})}))}),X=()=>l(void 0,null,function*(){j(!1)}),[$,N]=m.useState(!1),[T,J]=m.useState({}),Q=(a=0)=>l(void 0,null,function*(){a&&a>0&&(yield B({id:a}).then(o=>{J(Object.assign(T,c({},o.data)))}),N(!0))}),A=()=>{N(!1)};return s.jsxs(s.Fragment,{children:[s.jsx(ie,{}),s.jsx("div",{className:"py-4",children:s.jsxs(V,{children:[s.jsx(u,{onClick:()=>{z(0).then()},children:e("common:button_add")}),s.jsx(u,{onClick:f,children:e(r?"common:label_batch_operation_cancel":"common:label_batch_operation")}),s.jsx(u,{onClick:()=>{I().then()},children:e("common:button_delete")})]})}),s.jsx(ae,{ref:x,model:i,getDataList:U,rowSelectionEnabled:r,rowSelectionMultipleEnabled:r}),s.jsx(q,{open:$,title:e("common:user_field_username"),width:980,onOk:()=>{A()},onCancel:()=>{A()},children:T.username}),s.jsx(q,{open:G,title:H,width:980,onOk:()=>{K().then()},onCancel:()=>{X().then()},children:s.jsxs(_,d(c({},oe),{form:P,className:"entity-form",initialValues:y,children:[s.jsx(_.Item,d(c({},w),{name:"username",label:e("common:user_field_username"),rules:[{required:!0,message:e("common:user_field_username_validation")},({getFieldValue:a})=>({message:e("common:user_field_username_validation_check"),validator:(o,g)=>l(void 0,null,function*(){return ye(o,g,a("id"))})})],children:s.jsx(M,{placeholder:e("common:user_field_username_placeholder")})})),s.jsx(_.Item,d(c({},w),{name:"displayName",label:e("common:user_field_display_name"),rules:[{required:!0,message:e("common:user_field_display_name_validation")}],children:s.jsx(M,{placeholder:e("common:user_field_display_name_placeholder")})})),s.jsx(_.Item,d(c({},w),{name:"password",label:e("common:user_field_password"),rules:[{required:!0,message:e("common:user_field_password_validation")}],children:s.jsx(M.Password,{placeholder:e("common:user_field_password_placeholder")})})),s.jsx(_.Item,d(c({},w),{name:"status",label:e("common:field_status"),rules:[{required:!0,message:e("common:user_field_password_validation")}],children:s.jsxs(O.Group,{value:y.status,children:[s.jsx(O,{value:1,children:e("common:label_status_on")}),s.jsx(O,{value:0,children:e("common:label_status_off")})]})}))]}))})]})};export{Fe as default};
