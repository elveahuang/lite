var ht=(l,o,s)=>new Promise((i,e)=>{var t=a=>{try{r(s.next(a))}catch(u){e(u)}},n=a=>{try{r(s.throw(a))}catch(u){e(u)}},r=a=>a.done?i(a.value):Promise.resolve(a.value).then(t,n);r((s=s.apply(l,o)).next())});import{a7 as ci,a8 as hi,a9 as fi,R as K,aa as di,r as Te,ab as gi,f as Gt,w as vi,ac as pi,g as Ye,ad as mi,e as yi,ae as Wt,af as _i,ag as Ei,j as De,a5 as Ci}from"./index-Cy-1vFHR.js";import{_ as A,a as L,u as f,b as F,c as M,s as w,V as ki,d as k,S as Ti,e as bi,U as Si,W as st,f as P,g as I,t as xi,h as wi,i as ke,j as C,k as p,M as it,P as W,l as J,X as z,C as Ee,m as ft,n as Pi,F as ve,o as Ii,p as Ri,q as D,r as jt,R as Di,E as Ai,L as Ge,v as fe,w as Li,x as zt,B as We,A as Ke,y as Oi,z as Ie,D as Xe,G as Vt,H as se,I as dt,J as Ni,K as Fi,N as Mi,O as gt,Q as $t,T as Bi,Y as Hi,Z as be,$ as vt,a0 as pt,a1 as mt,a2 as yt,a3 as _t,a4 as Et,a5 as Ui,a6 as nt,a7 as Yt,a8 as at,a9 as Gi,aa as Wi,ab as Ve,ac as ot,ad as Ue,ae as Kt,af as ji,ag as ut,ah as zi,ai as Vi,aj as Xt,ak as $i,al as Yi,am as Ki,an as Xi,ao as qi,ap as Ji,aq as Ct,ar as qe,as as kt,at as Zi,au as Qi,av as en,aw as tn,ax as nn,ay as rn,az as sn,aA as an,aB as on,aC as un,aD as ln,aE as cn,aF as hn,aG as fn,aH as dn,aI as gn,aJ as vn,aK as pn,aL as mn,aM as yn,aN as _n}from"./XPlayer-B299lLD4.js";K.Component;var En={subtree:!0,childList:!0,attributeFilter:["style","class"]};function Cn(l,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:En;Te.useEffect(function(){if(!(!gi()||!l)){var i,e=Array.isArray(l)?l:[l];return"MutationObserver"in window&&(i=new MutationObserver(o),e.forEach(function(t){i.observe(t,s)})),function(){var t,n;(t=i)===null||t===void 0||t.takeRecords(),(n=i)===null||n===void 0||n.disconnect()}}},[s,l])}const qt=3;function Je(l,o){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=document.createElement("canvas"),e=i.getContext("2d"),t=l*s,n=o*s;return i.setAttribute("width",`${t}px`),i.setAttribute("height",`${n}px`),e.save(),[e,i,t,n]}function kn(){function l(o,s,i,e,t,n,r,a){const[u,c,h,g]=Je(e,t,i);if(o instanceof HTMLImageElement)u.drawImage(o,0,0,h,g);else{const{color:te,fontSize:ie,fontStyle:ne,fontWeight:le,fontFamily:xe,textAlign:Me}=n,Be=Number(ie)*i;u.font=`${ne} normal ${le} ${Be}px/${t}px ${xe}`,u.fillStyle=te,u.textAlign=Me,u.textBaseline="top";const we=Array.isArray(o)?o:[o];we==null||we.forEach((Pe,$e)=>{u.fillText(Pe!=null?Pe:"",h/2,$e*(Be+qt*i))})}const v=Math.PI/180*Number(s),d=Math.max(e,t),[y,m,_]=Je(d,d,i);y.translate(_/2,_/2),y.rotate(v),h>0&&g>0&&y.drawImage(c,-h/2,-g/2);function T(te,ie){const ne=te*Math.cos(v)-ie*Math.sin(v),le=te*Math.sin(v)+ie*Math.cos(v);return[ne,le]}let E=0,R=0,S=0,x=0;const b=h/2,B=g/2;[[0-b,0-B],[0+b,0-B],[0+b,0+B],[0-b,0+B]].forEach(te=>{let[ie,ne]=te;const[le,xe]=T(ie,ne);E=Math.min(E,le),R=Math.max(R,le),S=Math.min(S,xe),x=Math.max(x,xe)});const Z=E+_/2,ue=S+_/2,q=R-E,j=x-S,ee=r*i,Se=a*i,ae=(q+ee)*2,Oe=j+Se,[Ne,Fe]=Je(ae,Oe);function de(){let te=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;Ne.drawImage(m,Z,ue,q,j,te,ie,q,j)}return de(),de(q+ee,-j/2-Se/2),de(q+ee,+j/2+Se/2),[Fe.toDataURL(),ae/i,Oe/i]}return l}function Tn(l){const o=K.useRef(!1),s=K.useRef(),i=Gt(l);return()=>{o.current||(o.current=!0,i(),s.current=vi(()=>{o.current=!1}))}}function bn(l){return l.replace(/([A-Z])/g,"-$1").toLowerCase()}function Sn(l){return Object.keys(l).map(o=>`${bn(o)}: ${l[o]};`).join(" ")}function xn(){return window.devicePixelRatio||1}const wn=(l,o)=>{let s=!1;return l.removedNodes.length&&(s=Array.from(l.removedNodes).some(i=>o(i))),l.type==="attributes"&&o(l.target)&&(s=!0),s},Pn={visibility:"visible !important"};function In(l){const[o]=Te.useState(()=>new Map);return[(t,n,r)=>{if(r){if(!o.get(r)){const u=document.createElement("div");o.set(r,u)}const a=o.get(r);a.setAttribute("style",Sn(Object.assign(Object.assign(Object.assign({},l),{backgroundImage:`url('${t}')`,backgroundSize:`${Math.floor(n)}px`}),Pn))),a.removeAttribute("class"),a.parentElement!==r&&r.append(a)}return o.get(r)},t=>{const n=o.get(t);n&&t&&t.removeChild(n),o.delete(t)},t=>Array.from(o.values()).includes(t)]}function Tt(l,o){return l.size===o.size?l:o}const bt=100,St=100,xt={position:"relative",overflow:"hidden"},Rn=l=>{var o,s;const{zIndex:i=9,rotate:e=-22,width:t,height:n,image:r,content:a,font:u={},style:c,className:h,rootClassName:g,gap:v=[bt,St],offset:d,children:y,inherit:m=!0}=l,_=Object.assign(Object.assign({},xt),c),[,T]=pi(),{color:E=T.colorFill,fontSize:R=T.fontSizeLG,fontWeight:S="normal",fontStyle:x="normal",fontFamily:b="sans-serif",textAlign:B="center"}=u,[U=bt,Z=St]=v,ue=U/2,q=Z/2,j=(o=d==null?void 0:d[0])!==null&&o!==void 0?o:ue,ee=(s=d==null?void 0:d[1])!==null&&s!==void 0?s:q,Se=K.useMemo(()=>{const O={zIndex:i,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let N=j-ue,H=ee-q;return N>0&&(O.left=`${N}px`,O.width=`calc(100% - ${N}px)`,N=0),H>0&&(O.top=`${H}px`,O.height=`calc(100% - ${H}px)`,H=0),O.backgroundPosition=`${N}px ${H}px`,O},[i,j,ue,ee,q]),[ae,Oe]=K.useState(),[Ne,Fe]=K.useState(new Set),de=K.useMemo(()=>{const O=ae?[ae]:[];return[].concat(O,Ye(Array.from(Ne)))},[ae,Ne]),te=O=>{let N=120,H=64;if(!r&&O.measureText){O.font=`${Number(R)}px ${b}`;const oe=Array.isArray(a)?a:[a],ce=oe.map(Y=>{const V=O.measureText(Y);return[V.width,V.fontBoundingBoxAscent+V.fontBoundingBoxDescent]});N=Math.ceil(Math.max.apply(Math,Ye(ce.map(Y=>Y[0])))),H=Math.ceil(Math.max.apply(Math,Ye(ce.map(Y=>Y[1]))))*oe.length+(oe.length-1)*qt}return[t!=null?t:N,n!=null?n:H]},ie=kn(),[ne,le]=K.useState(null),Me=Tn(()=>{const N=document.createElement("canvas").getContext("2d");if(N){const H=xn(),[oe,ce]=te(N),Y=V=>{const[ui,li]=ie(V||"",e,H,oe,ce,{color:E,fontSize:R,fontStyle:x,fontWeight:S,fontFamily:b,textAlign:B},U,Z);le([ui,li])};if(r){const V=new Image;V.onload=()=>{Y(V)},V.onerror=()=>{Y(a)},V.crossOrigin="anonymous",V.referrerPolicy="no-referrer",V.src=r}else Y(a)}}),[Be,we,Pe]=In(Se);Te.useEffect(()=>{ne&&de.forEach(O=>{Be(ne[0],ne[1],O)})},[ne,de]);const $e=Gt(O=>{O.forEach(N=>{if(wn(N,Pe))Me();else if(N.target===ae&&N.attributeName==="style"){const H=Object.keys(xt);for(let oe=0;oe<H.length;oe+=1){const ce=H[oe],Y=_[ce],V=ae.style[ce];Y&&Y!==V&&(ae.style[ce]=Y)}}})});Cn(de,$e),Te.useEffect(Me,[e,i,t,n,r,a,E,R,S,x,b,B,U,Z,j,ee]);const ai=K.useMemo(()=>({add:O=>{Fe(N=>{const H=new Set(N);return H.add(O),Tt(N,H)})},remove:O=>{we(O),Fe(N=>{const H=new Set(N);return H.delete(O),Tt(N,H)})}}),[]),oi=m?K.createElement(mi.Provider,{value:ai},y):y;return K.createElement("div",{ref:Oe,className:yi(h,g),style:_},oi)};var Jt={exports:{}};(function(l){var o=Object.prototype.hasOwnProperty,s="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(s=!1));function e(a,u,c){this.fn=a,this.context=u,this.once=c||!1}function t(a,u,c,h,g){if(typeof c!="function")throw new TypeError("The listener must be a function");var v=new e(c,h||a,g),d=s?s+u:u;return a._events[d]?a._events[d].fn?a._events[d]=[a._events[d],v]:a._events[d].push(v):(a._events[d]=v,a._eventsCount++),a}function n(a,u){--a._eventsCount===0?a._events=new i:delete a._events[u]}function r(){this._events=new i,this._eventsCount=0}r.prototype.eventNames=function(){var u=[],c,h;if(this._eventsCount===0)return u;for(h in c=this._events)o.call(c,h)&&u.push(s?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},r.prototype.listeners=function(u){var c=s?s+u:u,h=this._events[c];if(!h)return[];if(h.fn)return[h.fn];for(var g=0,v=h.length,d=new Array(v);g<v;g++)d[g]=h[g].fn;return d},r.prototype.listenerCount=function(u){var c=s?s+u:u,h=this._events[c];return h?h.fn?1:h.length:0},r.prototype.emit=function(u,c,h,g,v,d){var y=s?s+u:u;if(!this._events[y])return!1;var m=this._events[y],_=arguments.length,T,E;if(m.fn){switch(m.once&&this.removeListener(u,m.fn,void 0,!0),_){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,c),!0;case 3:return m.fn.call(m.context,c,h),!0;case 4:return m.fn.call(m.context,c,h,g),!0;case 5:return m.fn.call(m.context,c,h,g,v),!0;case 6:return m.fn.call(m.context,c,h,g,v,d),!0}for(E=1,T=new Array(_-1);E<_;E++)T[E-1]=arguments[E];m.fn.apply(m.context,T)}else{var R=m.length,S;for(E=0;E<R;E++)switch(m[E].once&&this.removeListener(u,m[E].fn,void 0,!0),_){case 1:m[E].fn.call(m[E].context);break;case 2:m[E].fn.call(m[E].context,c);break;case 3:m[E].fn.call(m[E].context,c,h);break;case 4:m[E].fn.call(m[E].context,c,h,g);break;default:if(!T)for(S=1,T=new Array(_-1);S<_;S++)T[S-1]=arguments[S];m[E].fn.apply(m[E].context,T)}}return!0},r.prototype.on=function(u,c,h){return t(this,u,c,h,!1)},r.prototype.once=function(u,c,h){return t(this,u,c,h,!0)},r.prototype.removeListener=function(u,c,h,g){var v=s?s+u:u;if(!this._events[v])return this;if(!c)return n(this,v),this;var d=this._events[v];if(d.fn)d.fn===c&&(!g||d.once)&&(!h||d.context===h)&&n(this,v);else{for(var y=0,m=[],_=d.length;y<_;y++)(d[y].fn!==c||g&&!d[y].once||h&&d[y].context!==h)&&m.push(d[y]);m.length?this._events[v]=m.length===1?m[0]:m:n(this,v)}return this},r.prototype.removeAllListeners=function(u){var c;return u?(c=s?s+u:u,this._events[c]&&n(this,c)):(this._events=new i,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=s,r.EventEmitter=r,l.exports=r})(Jt);var Zt=Jt.exports;const Qt=Wt(Zt);var rt="3.0.18",wt={1:"media",2:"media",3:"media",4:"media",5:"media",6:"media"},Pt={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106},je=A(function l(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};L(this,l);var i=o&&o.i18n?o.i18n.ERROR_TYPES:null;if(o.media){var e=s.mediaError?s.mediaError:o.media.error||{},t=o.duration,n=o.currentTime,r=o.ended,a=o.src,u=o.currentSrc,c=o.media,h=c.readyState,g=c.networkState,v=s.errorCode||e.code;Pt[v]&&(v=Pt[v]);var d={playerVersion:rt,currentTime:n,duration:t,ended:r,readyState:h,networkState:g,src:a||u,errorType:s.errorType,errorCode:v,message:s.errorMessage||e.message,mediaError:e,originError:s.originError?s.originError.stack:"",host:f.getHostFromUrl(a||u)};return s.ext&&Object.keys(s.ext).map(function(T){d[T]=s.ext[T]}),d}else if(arguments.length>1){for(var y={playerVersion:rt,domain:document.domain},m=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],_=0;_<arguments.length;_++)y[m[_]]=arguments[_];return y.ex=i?(i[arguments[0]]||{}).msg:"",y}});function Ze(l,o){!this||!this.emit||(l==="error"?this.errorHandler(l,o.error):this.emit(l,o))}function Dn(l,o){return function(s,i){var e={player:o,eventName:l,originalEvent:s,detail:s.detail||{},timeStamp:s.timeStamp,currentTime:o.currentTime,duration:o.duration,paused:o.paused,ended:o.ended,isInternalOp:!!o._internalOp[s.type],muted:o.muted,volume:o.volume,host:f.getHostFromUrl(o.currentSrc),vtype:o.vtype};if(o.removeInnerOP(s.type),l==="timeupdate"&&(o._currentTime=o.media&&o.media.currentTime),l==="ratechange"){var t=o.media?o.media.playbackRate:0;if(t&&o._rate===t)return;o._rate=o.media&&o.media.playbackRate}if(l==="durationchange"&&(o._duration=o.media.duration),l==="volumechange"&&(e.isMutedChange=o._lastMuted!==o.muted,o._lastMuted=o.muted),l==="error"&&(e.error=i||o.video.error),o.mediaEventMiddleware[l]){var n=Ze.bind(o,l,e);try{o.mediaEventMiddleware[l].call(o,e,n)}catch(r){throw Ze.call(o,l,e),r}}else Ze.call(o,l,e)}}var An=function(l){F(s,l);var o=M(s);function s(i){var e;L(this,s),e=o.call(this,i),e._hasStart=!1,e._currentTime=0,e._duration=0,e._internalOp={},e._lastMuted=!1,e.vtype="MP4",e._rate=-1,e.mediaConfig=Object.assign({},{controls:!1,autoplay:i.autoplay,playsinline:i.playsinline,"x5-playsinline":i.playsinline,"webkit-playsinline":i.playsinline,"x5-video-player-fullscreen":i["x5-video-player-fullscreen"]||i.x5VideoPlayerFullscreen,"x5-video-orientation":i["x5-video-orientation"]||i.x5VideoOrientation,airplay:i.airplay,"webkit-airplay":i.airplay,tabindex:i.tabindex|0,mediaType:i.mediaType||"video","data-index":-1},i.videoConfig,i.videoAttributes);var t=i["x5-video-player-type"]||i.x5VideoPlayerType;return w.isWeixin&&w.os.isAndroid&&t&&(e.mediaConfig["x5-video-player-type"]=t,delete e.mediaConfig.playsinline,delete e.mediaConfig["webkit-playsinline"],delete e.mediaConfig["x5-playsinline"]),i.loop&&(e.mediaConfig.loop="loop"),i.autoplayMuted&&!Object.prototype.hasOwnProperty.call(e.mediaConfig,"muted")&&(e.mediaConfig.muted=!0),e.media=f.createDom(e.mediaConfig.mediaType,"",e.mediaConfig,""),i.defaultPlaybackRate&&(e.media.defaultPlaybackRate=e.media.playbackRate=i.defaultPlaybackRate),f.typeOf(i.volume)==="Number"&&(e.volume=i.volume),i.autoplayMuted&&(e.media.muted=!0,e._lastMuted=!0),i.autoplay&&(e.media.autoplay=!0),e._interval={},e.mediaEventMiddleware={},e.attachVideoEvents(),e}return A(s,[{key:"setEventsMiddleware",value:function(e){var t=this;Object.keys(e).map(function(n){t.mediaEventMiddleware[n]=e[n]})}},{key:"removeEventsMiddleware",value:function(e){var t=this;Object.keys(e).map(function(n){delete t.mediaEventMiddleware[n]})}},{key:"attachVideoEvents",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.media;this._evHandlers||(this._evHandlers=ki.map(function(n){var r="on".concat(n.charAt(0).toUpperCase()).concat(n.slice(1));return typeof e[r]=="function"&&e.on(n,e[r]),k({},n,Dn(n,e))})),this._evHandlers.forEach(function(n){var r=Object.keys(n)[0];t.addEventListener(r,n[r],!1)})}},{key:"detachVideoEvents",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.media;this._evHandlers.forEach(function(n){var r=Object.keys(n)[0];t.removeEventListener(r,n[r],!1)}),this._evHandlers.forEach(function(n){var r=Object.keys(n)[0],a="on".concat(r.charAt(0).toUpperCase()).concat(r.slice(1));typeof e[a]=="function"&&e.off(r,e[a])}),this._evHandlers=null}},{key:"_attachSourceEvents",value:function(e,t){var n=this;e.removeAttribute("src"),e.load(),t.forEach(function(h,g){n.media.appendChild(f.createDom("source","",{src:"".concat(h.src),type:"".concat(h.type||""),"data-index":g+1}))});var r=e.children;if(r){this._videoSourceCount=r.length,this._videoSourceIndex=r.length,this._vLoadeddata=function(h){n.emit(Ti,{src:h.target.currentSrc,host:f.getHostFromUrl(h.target.currentSrc)})};for(var a=null,u=0;u<this._evHandlers.length;u++)if(Object.keys(this._evHandlers[u])[0]==="error"){a=this._evHandlers[u];break}!this._sourceError&&(this._sourceError=function(h){var g=parseInt(h.target.getAttribute("data-index"),10);if(n._videoSourceIndex--,n._videoSourceIndex===0||g>=n._videoSourceCount){var v={code:4,message:"sources_load_error"};a?a.error(h,v):n.errorHandler("error",v)}var d=wt[4];n.emit(bi,new je(n,{errorType:d,errorCode:4,errorMessage:"sources_load_error",mediaError:{code:4,message:"sources_load_error"},src:h.target.src}))});for(var c=0;c<r.length;c++)r[c].addEventListener("error",this._sourceError);e.addEventListener("loadeddata",this._vLoadeddata)}}},{key:"_detachSourceEvents",value:function(e){var t=e.children;if(!(!t||t.length===0||!this._sourceError)){for(var n=0;n<t.length;n++)t[n].removeEventListener("error",this._sourceError);for(;t.length>0;)e.removeChild(t[0]);this._vLoadeddata&&e.removeEventListener("loadeddata",this._vLoadeddata)}}},{key:"errorHandler",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.media&&(this.media.error||t)){var n=this.media.error||t,r=n.code?wt[n.code]:"other",a=n.message;this.media.currentSrc||(a="empty_src",n={code:6,message:a}),this.emit(e,new je(this,{errorType:r,errorCode:n.code,errorMessage:n.message||"",mediaError:n}))}}},{key:"destroy",value:function(){this.media&&(this.media.pause&&(this.media.pause(),this.media.muted=!0),this.media.removeAttribute("src"),this.media.load()),this._currentTime=0,this._duration=0,this.mediaConfig=null;for(var e in this._interval)Object.prototype.hasOwnProperty.call(this._interval,e)&&(clearInterval(this._interval[e]),this._interval[e]=null);this.detachVideoEvents(),this.media=null,this.mediaEventMiddleware={},this.removeAllListeners()}},{key:"video",get:function(){return this.media},set:function(e){this.media=e}},{key:"play",value:function(){var e=this.media?this.media.play():null;return e}},{key:"pause",value:function(){this.media&&this.media.pause()}},{key:"load",value:function(){this.media&&this.media.load()}},{key:"canPlayType",value:function(e){return this.media?this.media.canPlayType(e):!1}},{key:"getBufferedRange",value:function(e){var t=[0,0];if(!this.media)return t;e||(e=this.media.buffered);var n=this.media.currentTime;if(e)for(var r=0,a=e.length;r<a&&(t[0]=e.start(r),t[1]=e.end(r),!(t[0]<=n&&n<=t[1]));r++);return t[0]-n<=0&&n-t[1]<=0?t:[0,0]}},{key:"autoplay",get:function(){return this.media?this.media.autoplay:!1},set:function(e){this.media&&(this.media.autoplay=e)}},{key:"buffered",get:function(){return this.media?this.media.buffered:null}},{key:"buffered2",get:function(){return this.media&&this.media.buffered?f.getBuffered2(this.media.buffered):null}},{key:"bufferedPoint",get:function(){var e={start:0,end:0};if(!this.media)return e;var t=this.media.buffered;if(!t||t.length===0)return e;for(var n=0;n<t.length;n++)if((t.start(n)<=this.currentTime||t.start(n)<.1)&&t.end(n)>=this.currentTime)return{start:t.start(n),end:t.end(n)};return e}},{key:"crossOrigin",get:function(){return this.media?this.media.crossOrigin:""},set:function(e){this.media&&(this.media.crossOrigin=e)}},{key:"currentSrc",get:function(){return this.media?this.media.currentSrc:""},set:function(e){this.media&&(this.media.currentSrc=e)}},{key:"currentTime",get:function(){return this.media?this.media.currentTime!==void 0?this.media.currentTime:this._currentTime:0},set:function(e){this.media&&(this.media.currentTime=e)}},{key:"defaultMuted",get:function(){return this.media?this.media.defaultMuted:!1},set:function(e){this.media&&(this.media.defaultMuted=e)}},{key:"duration",get:function(){return this._duration}},{key:"ended",get:function(){return this.media?this.media.ended:!1}},{key:"error",get:function(){return this.media.error}},{key:"errorNote",get:function(){var e=this.media.error;if(!e)return"";var t=["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"];return t[this.media.error.code-1]}},{key:"loop",get:function(){return this.media?this.media.loop:!1},set:function(e){this.media&&(this.media.loop=e)}},{key:"muted",get:function(){return this.media?this.media.muted:!1},set:function(e){!this.media||this.media.muted===e||(this._lastMuted=this.media.muted,this.media.muted=e)}},{key:"networkState",get:function(){return this.media.networkState}},{key:"paused",get:function(){return this.media?this.media.paused:!0}},{key:"playbackRate",get:function(){return this.media?this.media.playbackRate:0},set:function(e){!this.media||e===1/0||(this.media.defaultPlaybackRate=e,this.media.playbackRate=e)}},{key:"played",get:function(){return this.media?this.media.played:null}},{key:"preload",get:function(){return this.media?this.media.preload:!1},set:function(e){this.media&&(this.media.preload=e)}},{key:"readyState",get:function(){return this.media.readyState}},{key:"seekable",get:function(){return this.media?this.media.seekable:!1}},{key:"seeking",get:function(){return this.media?this.media.seeking:!1}},{key:"src",get:function(){return this.media?this.media.src:""},set:function(e){if(this.media){if(this.emit(Si,e),this.emit(st),this._currentTime=0,this._duration=0,f.isMSE(this.media)){this.onWaiting();return}this._detachSourceEvents(this.media),f.typeOf(e)==="Array"?this._attachSourceEvents(this.media,e):e?this.media.src=e:this.media.removeAttribute("src"),this.load()}}},{key:"volume",get:function(){return this.media?this.media.volume:0},set:function(e){e===1/0||!this.media||(this.media.volume=e)}},{key:"aspectRatio",get:function(){return this.media?this.media.videoWidth/this.media.videoHeight:0}},{key:"addInnerOP",value:function(e){this._internalOp[e]=!0}},{key:"removeInnerOP",value:function(e){delete this._internalOp[e]}},{key:"emit",value:function(e,t){for(var n,r=arguments.length,a=new Array(r>2?r-2:0),u=2;u<r;u++)a[u-2]=arguments[u];(n=P(I(s.prototype),"emit",this)).call.apply(n,[this,e,t].concat(a))}},{key:"on",value:function(e,t){for(var n,r=arguments.length,a=new Array(r>2?r-2:0),u=2;u<r;u++)a[u-2]=arguments[u];(n=P(I(s.prototype),"on",this)).call.apply(n,[this,e,t].concat(a))}},{key:"once",value:function(e,t){for(var n,r=arguments.length,a=new Array(r>2?r-2:0),u=2;u<r;u++)a[u-2]=arguments[u];(n=P(I(s.prototype),"once",this)).call.apply(n,[this,e,t].concat(a))}},{key:"off",value:function(e,t){for(var n,r=arguments.length,a=new Array(r>2?r-2:0),u=2;u<r;u++)a[u-2]=arguments[u];(n=P(I(s.prototype),"off",this)).call.apply(n,[this,e,t].concat(a))}},{key:"offAll",value:function(){P(I(s.prototype),"removeAllListeners",this).call(this)}}]),s}(Qt),Ln=function(){function l(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}};L(this,l),this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=o}return A(l,[{key:"openDB",value:function(s){var i=this,e=this,t=this.myDB.version||1,n=e.indexedDB.open(e.myDB.name,t);n.onerror=function(r){},n.onsuccess=function(r){i.myDB.db=r.target.result,s.call(e)},n.onupgradeneeded=function(r){var a=r.target.result;r.target.transaction,a.objectStoreNames.contains(e.myDB.ojstore.name)||a.createObjectStore(e.myDB.ojstore.name,{keyPath:e.myDB.ojstore.keypath})}}},{key:"deletedb",value:function(){var s=this;s.indexedDB.deleteDatabase(this.myDB.name)}},{key:"closeDB",value:function(){this.myDB.db.close()}},{key:"addData",value:function(s,i){for(var e=this.myDB.db.transaction(s,"readwrite").objectStore(s),t,n=0;n<i.length;n++)t=e.add(i[n]),t.onerror=function(){},t.onsuccess=function(){}}},{key:"putData",value:function(s,i){for(var e=this.myDB.db.transaction(s,"readwrite").objectStore(s),t,n=0;n<i.length;n++)t=e.put(i[n]),t.onerror=function(){},t.onsuccess=function(){}}},{key:"getDataByKey",value:function(s,i,e){var t=this,n=this.myDB.db.transaction(s,"readwrite").objectStore(s),r=n.get(i);r.onerror=function(){e.call(t,null)},r.onsuccess=function(a){var u=a.target.result;e.call(t,u)}}},{key:"deleteData",value:function(s,i){var e=this.myDB.db.transaction(s,"readwrite").objectStore(s);e.delete(i)}},{key:"clearData",value:function(s){var i=this.myDB.db.transaction(s,"readwrite").objectStore(s);i.clear()}}]),l}(),It=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],Rt=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],Dt=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],pe="data-xgplayerid",On=function(){function l(){var o=this;if(L(this,l),k(this,"__trigger",function(s){var i=new Date().getTime();o.timeStamp=i;for(var e=0;e<s.length;e++)o.__runHandler(s[e].target)}),this.__handlers=[],this.timeStamp=0,this.observer=null,!!window.ResizeObserver)try{this.observer=new window.ResizeObserver(xi(this.__trigger,100,{trailing:!0})),this.timeStamp=new Date().getTime()}catch(s){console.error(s)}}return A(l,[{key:"addObserver",value:function(s,i){if(this.observer){this.observer&&this.observer.observe(s);for(var e=s.getAttribute(pe),t=this.__handlers,n=-1,r=0;r<t.length;r++)t[r]&&s===t[r].target&&(n=r);n>-1?this.__handlers[n].handler=i:this.__handlers.push({target:s,handler:i,playerId:e})}}},{key:"unObserver",value:function(s){var i=-1;this.__handlers.map(function(e,t){s===e.target&&(i=t)});try{this.observer&&this.observer.unobserve(s)}catch(e){}this.observer&&this.observer.unobserve(s),i>-1&&this.__handlers.splice(i,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(s){for(var i=this.__handlers,e=0;e<i.length;e++)if(i[e]&&s===i[e].target){try{i[e].handler(s)}catch(t){console.error(t)}return!0}return!1}}]),l}(),Re=null;function Nn(l,o){return Re||(Re=new On),Re.addObserver(l,o),Re}function Fn(l,o){Re.unObserver(l,o)}var G={pluginGroup:{},init:function(o){var s=o._pluginInfoId;s||(s=new Date().getTime(),o._pluginInfoId=s),!o.config.closeResizeObserver&&Nn(o.root,function(){o.resize()}),this.pluginGroup[s]={_originalOptions:o.config||{},_plugins:{}}},formatPluginInfo:function(o,s){var i=null,e=null;return o.plugin&&typeof o.plugin=="function"?(i=o.plugin,e=o.options):(i=o,e={}),s&&(e.config=s||{}),{PLUFGIN:i,options:e}},checkPluginIfExits:function(o,s){for(var i=0;i<s.length;i++)if(o.toLowerCase()===s[i].pluginName.toLowerCase())return!0;return!1},getRootByConfig:function(o,s){for(var i=Object.keys(s),e=null,t=0;t<i.length;t++)if(o.toLowerCase()===i[t].toLowerCase()){e=s[i[t]];break}return f.typeOf(e)==="Object"?{root:e.root,position:e.position}:{}},lazyRegister:function(o,s){var i=this,e=s.timeout||1500;return Promise.race([s.loader().then(function(t){var n;t&&t.__esModule?n=t.default:n=t,i.register(o,n,t.options)}),new Promise(function(t,n){setTimeout(function(){n(new Error("timeout"))},e)})])},register:function(o,s){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!(!o||!s||typeof s!="function"||s.prototype===void 0)){var e=o._pluginInfoId;if(!(!e||!this.pluginGroup[e])){this.pluginGroup[e]._plugins||(this.pluginGroup[e]._plugins={});var t=this.pluginGroup[e]._plugins,n=this.pluginGroup[e]._originalOptions;i.player=o;var r=i.pluginName||s.pluginName;if(!r)throw new Error("The property pluginName is necessary");if(s.isSupported&&!s.isSupported(o.config.mediaType,o.config.codecType)){console.warn("not supported plugin [".concat(r,"]"));return}i.config||(i.config={});for(var a=Object.keys(n),u=0;u<a.length;u++)if(r.toLowerCase()===a[u].toLowerCase()){var c=n[a[u]];f.typeOf(c)==="Object"?i.config=Object.assign({},i.config,n[a[u]]):f.typeOf(c)==="Boolean"&&(i.config.disable=!c);break}s.defaultConfig&&Object.keys(s.defaultConfig).forEach(function(g){typeof i.config[g]=="undefined"&&(i.config[g]=s.defaultConfig[g])}),i.root?typeof i.root=="string"&&(i.root=o[i.root]):i.root=o.root,i.index=i.config.index||0;try{t[r.toLowerCase()]&&(this.unRegister(e,r.toLowerCase()),console.warn("the is one plugin with same pluginName [".concat(r,"] exist, destroy the old instance")));var h=new s(i);return t[r.toLowerCase()]=h,t[r.toLowerCase()].func=s,h&&typeof h.afterCreate=="function"&&h.afterCreate(),h}catch(g){throw console.error(g),g}}}},unRegister:function(o,s){o._pluginInfoId&&(o=o._pluginInfoId),s=s.toLowerCase();try{var i=this.pluginGroup[o]._plugins[s];i&&(i.pluginName&&i.__destroy(),delete this.pluginGroup[o]._plugins[s])}catch(e){console.error("[unRegister:".concat(s,"] cgid:[").concat(o,"] error"),e)}},deletePlugin:function(o,s){var i=o._pluginInfoId;i&&this.pluginGroup[i]&&this.pluginGroup[i]._plugins&&delete this.pluginGroup[i]._plugins[s]},getPlugins:function(o){var s=o._pluginInfoId;return s&&this.pluginGroup[s]?this.pluginGroup[s]._plugins:{}},findPlugin:function(o,s){var i=o._pluginInfoId;if(!i||!this.pluginGroup[i])return null;var e=s.toLowerCase();return this.pluginGroup[i]._plugins[e]},beforeInit:function(o){var s=this;function i(e){return!e||!e.then?new Promise(function(t){t()}):e}return new Promise(function(e){if(s.pluginGroup){var t;return o._loadingPlugins&&o._loadingPlugins.length?t=Promise.all(o._loadingPlugins):t=Promise.resolve(),t.then(function(){var n=o._pluginInfoId;if(!s.pluginGroup[n]){e();return}var r=s.pluginGroup[n]._plugins,a=[];Object.keys(r).forEach(function(u){if(r[u]&&r[u].beforePlayerInit)try{var c=r[u].beforePlayerInit();a.push(i(c))}catch(h){throw a.push(i(null)),h}}),Promise.all([].concat(a)).then(function(){e()}).catch(function(u){console.error(u),e()})})}})},afterInit:function(o){var s=o._pluginInfoId;if(!(!s||!this.pluginGroup[s])){var i=this.pluginGroup[s]._plugins;Object.keys(i).forEach(function(e){i[e]&&i[e].afterPlayerInit&&i[e].afterPlayerInit()})}},setLang:function(o,s){var i=s._pluginInfoId;if(!(!i||!this.pluginGroup[i])){var e=this.pluginGroup[i]._plugins;Object.keys(e).forEach(function(t){if(e[t].updateLang)e[t].updateLang(o);else try{e[t].lang=o}catch(n){console.warn("".concat(t," setLang"))}})}},reRender:function(o){var s=this,i=o._pluginInfoId;if(!(!i||!this.pluginGroup[i])){var e=[],t=this.pluginGroup[i]._plugins;Object.keys(t).forEach(function(n){n!=="controls"&&t[n]&&(e.push({plugin:t[n].func,options:t[n].__args}),s.unRegister(i,n))}),e.forEach(function(n){s.register(o,n.plugin,n.options)})}},onPluginsReady:function(o){var s=o._pluginInfoId;if(!(!s||!this.pluginGroup[s])){var i=this.pluginGroup[s]._plugins||{};Object.keys(i).forEach(function(e){i[e].onPluginsReady&&typeof i[e].onPluginsReady=="function"&&i[e].onPluginsReady()})}},destroy:function(o){var s=o._pluginInfoId;if(this.pluginGroup[s]){Fn(o.root);for(var i=this.pluginGroup[s]._plugins,e=0,t=Object.keys(i);e<t.length;e++){var n=t[e];this.unRegister(s,n)}delete this.pluginGroup[s],delete o._pluginInfoId}}};function At(){return{id:"",el:null,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!0,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!0,closeControlsBlur:!0,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:function(){},enableSwipeHandler:function(){},preProcessUrl:null,ignores:[],whitelist:[],inactive:3e3,lang:wi(),controls:!0,marginControls:!1,fullscreenTarget:null,screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],tabindex:0,thumbnail:null,videoConfig:{},isHideTips:!1,minWaitDelay:200,commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}}}var Mn=function(o,s){var i,e,t;s.preset&&s.options?t=new s.preset(s.options,o.config):t=new s({},o.config);var n=t,r=n.plugins,a=r===void 0?[]:r,u=n.ignores,c=u===void 0?[]:u,h=n.icons,g=h===void 0?{}:h,v=n.i18n,d=v===void 0?[]:v;o.config.plugins||(o.config.plugins=[]),o.config.ignores||(o.config.ignores=[]),(i=o.config.plugins).push.apply(i,ke(a)),(e=o.config.ignores).push.apply(e,ke(c)),Object.keys(g).map(function(m){o.config.icons[m]||(o.config.icons[m]=g[m])});var y=o.config.i18n||[];d.push.apply(d,ke(y)),o.config.i18n=d},Bn=function(l){F(s,l);var o=M(s);function s(){var i;L(this,s);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i=o.call.apply(o,[this].concat(t)),k(C(i),"onMouseEnter",function(r){var a=C(i),u=a.player,c=a.playerConfig;c.closeControlsBlur&&u.focus({autoHide:!1})}),k(C(i),"onMouseLeave",function(r){var a=C(i),u=a.player;u.focus()}),i}return A(s,[{key:"beforeCreate",value:function(e){!e.config.mode&&w.device==="mobile"&&(e.config.mode="flex"),e.player.config.marginControls&&(e.config.autoHide=!1)}},{key:"afterCreate",value:function(){var e=this,t=this.config,n=t.disable,r=t.height,a=t.mode;if(!n){a==="flex"&&this.player.addClass(p.FLEX_CONTROLS);var u={height:"".concat(r,"px")};Object.keys(u).map(function(h){e.root.style[h]=u[h]}),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on(it,function(h){h?f.addClass(e.root,"mini-controls"):f.removeClass(e.root,"mini-controls")});var c=this.playerConfig.isMobileSimulateMode;w.device!=="mobile"&&c!=="mobile"&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}}},{key:"focus",value:function(){this.player.focus({autoHide:!1})}},{key:"focusAwhile",value:function(){this.player.focus({autoHide:!0})}},{key:"blur",value:function(){this.player.blur({ignorePaused:!0})}},{key:"recoverAutoHide",value:function(){this.config.autoHide&&f.addClass(this.root,p.CONTROLS_AUTOHIDE)}},{key:"pauseAutoHide",value:function(){f.removeClass(this.root,p.CONTROLS_AUTOHIDE)}},{key:"show",value:function(e){this.root.style.display="",this.player.focus()}},{key:"hide",value:function(){this.root.style.display="none"}},{key:"mode",get:function(){return this.config.mode}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(this.root){var r=e.defaultConfig||{};if(!t.root){var a=t.position?t.position:t.config&&t.config.position?t.config.position:r.position;switch(a){case W.CONTROLS_LEFT:t.root=this.left;break;case W.CONTROLS_RIGHT:t.root=this.right;break;case W.CONTROLS_CENTER:t.root=this.center;break;case W.CONTROLS:t.root=this.root;break;default:t.root=this.left}return P(I(s.prototype),"registerPlugin",this).call(this,e,t,n)}}}},{key:"destroy",value:function(){w.device!=="mobile"&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave))}},{key:"render",value:function(){var e=this.config,t=e.mode,n=e.autoHide,r=e.initShow,a=e.disable;if(!a){var u=f.classNames({"xgplayer-controls":!0},{"flex-controls":t==="flex"},{"bottom-controls":t==="bottom"},k({},p.CONTROLS_AUTOHIDE,n),{"xgplayer-controls-initshow":r||!n});return'<xg-controls class="'.concat(u,`" unselectable="on">
    <xg-inner-controls class="xg-inner-controls xg-pos">
      <xg-left-grid class="xg-left-grid">
      </xg-left-grid>
      <xg-center-grid class="xg-center-grid"></xg-center-grid>
      <xg-right-grid class="xg-right-grid">
      </xg-right-grid>
    </xg-inner-controls>
    </xg-controls>`)}}}],[{key:"pluginName",get:function(){return"controls"}},{key:"defaultConfig",get:function(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}}]),s}(J),Hn={LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}},X={lang:{},langKeys:[],textKeys:[]};function Ae(l,o){return Object.keys(o).forEach(function(s){var i=f.typeOf(o[s]),e=f.typeOf(l[s]);if(i==="Array"){var t;e!=="Array"&&(l[s]=[]),(t=l[s]).push.apply(t,ke(o[s]))}else i==="Object"?(e!=="Object"&&(l[s]={}),Ae(l[s],o[s])):l[s]=o[s]}),l}function ei(){Object.keys(X.lang.en).map(function(l){X.textKeys[l]=l})}function Un(l,o){var s=[];if(o||(o=X),!!o.lang){f.typeOf(l)!=="Array"?s=Object.keys(l).map(function(t){var n=t==="zh"?"zh-cn":t;return{LANG:n,TEXT:l[t]}}):s=l;var i=o,e=i.lang;s.map(function(t){t.LANG==="zh"&&(t.LANG="zh-cn"),e[t.LANG]?Ae(e[t.LANG]||{},t.TEXT||{}):lt(t,o)}),ei()}}function lt(l,o){var s=l.LANG;if(o||(o=X),!!o.lang){var i=l.TEXT||{};s==="zh"&&(s="zh-cn"),o.lang[s]?Ae(o.lang[s],i):(o.langKeys.push(s),o.lang[s]=i),ei()}}function Gn(l){var o,s={lang:{},langKeys:[],textKeys:{},pId:l};return Ae(s.lang,X.lang),(o=s.langKeys).push.apply(o,ke(X.langKeys)),Ae(s.textKeys,X.textKeys),s}lt(Hn);var Ce={get textKeys(){return X.textKeys},get langKeys(){return X.langKeys},get lang(){var l={};return X.langKeys.map(function(o){l[o]=X.lang[o]}),X.lang["zh-cn"]&&(l.zh=X.lang["zh-cn"]||{}),l},extend:Un,use:lt,init:Gn},$={},Qe=null,ti=function(l){F(s,l);var o=M(s);function s(){return L(this,s),o.apply(this,arguments)}return A(s,[{key:"add",value:function(e){e&&($[e.playerId]=e,Object.keys($).length===1&&this.setActive(e.playerId,!0))}},{key:"remove",value:function(e){e&&(e.isUserActive,delete $[e.playerId])}},{key:"_iterate",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(var n in $)if(Object.prototype.hasOwnProperty.call($,n)){var r=$[n];if(t){if(e(r))break}else e(r)}}},{key:"forEach",value:function(e){this._iterate(e)}},{key:"find",value:function(e){var t=null;return this._iterate(function(n){var r=e(n);return r&&(t=n),r},!0),t}},{key:"findAll",value:function(e){var t=[];return this._iterate(function(n){e(n)&&t.push(n)}),t}},{key:"setActive",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if($[e])return t?this.forEach(function(n){e===n.playerId?(n.isUserActive=!0,n.isInstNext=!1):n.isUserActive=!1}):$[e].isUserActive=t,e}},{key:"getActiveId",value:function(){for(var e=Object.keys($),t=0;t<e.length;t++){var n=$[e[t]];if(n&&n.isUserActive)return e[t]}return null}},{key:"setNext",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if($[e])return t?this.forEach(function(n){e===n.playerId?(n.isUserActive=!1,n.isInstNext=!0):n.isInstNext=!1}):$[e].isInstNext=t,e}}],[{key:"getInstance",value:function(){return Qe||(Qe=new s),Qe}}]),s}(Zt.EventEmitter);function Wn(l){for(var o=Object.keys($),s=0;s<o.length;s++){var i=$[o[s]];if(i.root===l)return i}return null}var jn=["play","pause","replay","retry"],Lt=0,Ot=0,he=null,Le=function(l){F(s,l);var o=M(s);function s(i){var e;L(this,s);var t=f.deepMerge(At(),i);e=o.call(this,t),k(C(e),"canPlayFunc",function(){if(e.config){var d=e.config,y=d.autoplay,m=d.defaultPlaybackRate;z.logInfo("player","canPlayFunc, startTime",e.__startTime),e.__startTime>0&&e.duration>0&&(e.currentTime=e.__startTime>e.duration?e.duration:e.__startTime,e.__startTime=-1),e.playbackRate=m,(y||e._useAutoplay)&&e.mediaPlay(),e.off(Ee,e.canPlayFunc),e.removeClass(p.ENTER)}}),k(C(e),"onFullscreenChange",function(d,y){var m=function(){f.setTimeout(C(e),function(){e.resize()},100)},_=f.getFullScreenEl();e._fullActionFrom?e._fullActionFrom="":e.emit(ft,{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:e.currentTime,duration:e.duration,props:[{prop:"fullscreen",from:!0,to:!1}]});var T=Pi(_,e.playerId,pe);if(y||_&&(_===e._fullscreenEl||T))m(),!e.config.closeFocusVideoFocus&&e.media.focus(),e.fullscreen=!0,e.changeFullStyle(e.root,_,p.FULLSCREEN),e.emit(ve,!0,e._fullScreenOffset),e.cssfullscreen&&e.exitCssFullscreen();else if(e.fullscreen){m();var E=C(e),R=E._fullScreenOffset,S=E.config;if(S.needFullscreenScroll?(window.scrollTo(R.left,R.top),f.setTimeout(C(e),function(){e.fullscreen=!1,e._fullScreenOffset=null},100)):(!e.config.closeFocusVideoFocus&&e.media.focus(),e.fullscreen=!1,e._fullScreenOffset=null),e.cssfullscreen)e.removeClass(p.FULLSCREEN);else{var x=e._fullscreenEl;!x&&(e.root.contains(d.target)||d.target===e.root)&&(x=d.target),e.recoverFullStyle(e.root,x,p.FULLSCREEN)}e._fullscreenEl=null,e.emit(ve,!1)}}),k(C(e),"_onWebkitbeginfullscreen",function(d){e._fullscreenEl=e.media,e.onFullscreenChange(d,!0)}),k(C(e),"_onWebkitendfullscreen",function(d){e.onFullscreenChange(d,!1)}),Ii(C(e),jn),e.config=t,e._pluginInfoId=f.generateSessionId(),Ri(C(e));var n=e.constructor.defaultPreset;if(e.config.presets.length){var r=e.config.presets.indexOf("default");r>=0&&n&&(e.config.presets[r]=n)}else n&&e.config.presets.push(n);e.userTimer=null,e.waitTimer=null,e.handleSource=!0,e._state=D.INITIAL,e.isError=!1,e._hasStart=!1,e.isSeeking=!1,e.isCanplay=!1,e._useAutoplay=!1,e.__startTime=-1,e.rotateDeg=0,e.isActive=!1,e.fullscreen=!1,e.cssfullscreen=!1,e.isRotateFullscreen=!1,e._fullscreenEl=null,e.timeSegments=[],e._cssfullscreenEl=null,e.curDefinition=null,e._orgCss="",e._fullScreenOffset=null,e._videoHeight=0,e._videoWidth=0,e.videoPos={pi:1,scale:0,rotate:-1,x:0,y:0,h:-1,w:-1,vy:0,vx:0},e.sizeInfo={width:0,height:0,left:0,top:0},e._accPlayed={t:0,acc:0,loopAcc:0},e._offsetInfo={currentTime:-1,duration:0},e.innerContainer=null,e.controls=null,e.topBar=null,e.root=null,e.__i18n=Ce.init(e._pluginInfoId),w.os.isAndroid&&w.osVersion>0&&w.osVersion<6&&(e.config.autoplay=!1),e.database=new Ln,e.isUserActive=!1,e._onceSeekCanplay=null,e._isPauseBeforeSeek=0,e.innerStates={isActiveLocked:!1},e.instManager=he;var a=e._initDOM();if(!a)return console.error(new Error("can't find the dom which id is ".concat(e.config.id," or this.config.el does not exist"))),jt(e);var u=e.config,c=u.definition,h=c===void 0?{}:c,g=u.url;if(!g&&h.list&&h.list.length>0){var v=h.list.find(function(d){return d.definition&&d.definition===h.defaultDefinition});v||(h.defaultDefinition=h.list[0].definition,v=h.list[0]),e.config.url=v.url,e.curDefinition=v}return e._bindEvents(),e._registerPresets(),e._registerPlugins(),G.onPluginsReady(C(e)),e.getInitDefinition(),e.setState(D.READY),f.setTimeout(C(e),function(){e.emit(Di)},0),e.onReady&&e.onReady(),(e.config.videoInit||e.config.autoplay)&&(!e.hasStart||e.state<D.ATTACHED)&&e.start(),e}return A(s,[{key:"_initDOM",value:function(){var e,t=this;if(this.root=this.config.id?document.getElementById(this.config.id):null,!this.root){var n=this.config.el;if(n&&n.nodeType===1)this.root=n;else return this.emit(Ai,new je("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),console.error("this.confg.id or this.config.el can't be empty"),!1}var r=Wn(this.root);r&&(z.logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),r.destroy()),this.root.setAttribute(pe,this.playerId),(e=he)===null||e===void 0||e.add(this),G.init(this),this._initBaseDoms();var a=this.constructor.XgVideoProxy;if(a&&this.mediaConfig.mediaType===a.mediaType){var u=this.innerContainer||this.root;this.detachVideoEvents(this.media);var c=new a(u,this.config,this.mediaConfig);this.attachVideoEvents(c),this.media=c}if(this.media.setAttribute(pe,this.playerId),this.config.controls){var h=this.config.controls.root||null,g=G.register(this,Bn,{root:h});this.controls=g}var v=this.config.isMobileSimulateMode==="mobile"?"mobile":w.device;if(this.addClass("".concat(p.DEFAULT," ").concat(p.INACTIVE," xgplayer-").concat(v," ").concat(this.config.controls?"":p.NO_CONTROLS)),this.config.autoplay?this.addClass(p.ENTER):this.addClass(p.NO_START),this.config.fluid){var d=this.config,y=d.width,m=d.height;(typeof y!="number"||typeof m!="number")&&(y=600,m=337.5);var _={width:"100%",height:"0","max-width":"100%","padding-top":"".concat(m*100/y,"%")};Object.keys(_).forEach(function(b){t.root.style[b]=_[b]})}else["width","height"].forEach(function(b){t.config[b]&&(typeof t.config[b]!="number"?t.root.style[b]=t.config[b]:t.root.style[b]="".concat(t.config[b],"px"))});var T=this.root.getBoundingClientRect(),E=T.width,R=T.height,S=T.left,x=T.top;return this.sizeInfo.width=E,this.sizeInfo.height=R,this.sizeInfo.left=S,this.sizeInfo.top=x,!0}},{key:"_initBaseDoms",value:function(){this.topBar=null,this.leftBar=null,this.rightBar=null,this.config.marginControls&&(this.innerContainer=f.createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer))}},{key:"_bindEvents",value:function(){var e=this;["focus","blur"].forEach(function(t){e.on(t,e["on"+t.charAt(0).toUpperCase()+t.slice(1)])}),It.forEach(function(t){document&&document.addEventListener(t,e.onFullscreenChange)}),w.os.isIos&&(this.media.addEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.addEventListener("webkitendfullscreen",this._onWebkitendfullscreen)),this.once(Ge,this.resize),this.playFunc=function(){e.config.closeFocusVideoFocus||e.media.focus()},this.once(fe,this.playFunc)}},{key:"_unbindEvents",value:function(){var e=this;this.root.removeEventListener("mousemove",this.mousemoveFunc),It.forEach(function(t){document.removeEventListener(t,e.onFullscreenChange)}),this.playFunc&&this.off(fe,this.playFunc),this.off(Ee,this.canPlayFunc),this.media.removeEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.removeEventListener("webkitendfullscreen",this._onWebkitendfullscreen)}},{key:"_clearUserTimer",value:function(){this.userTimer&&(f.clearTimeout(this,this.userTimer),this.userTimer=null)}},{key:"_startInit",value:function(e){var t=this;if(this.media&&!((!e||e===""||f.typeOf(e)==="Array"&&e.length===0)&&(e="",this.emit(Li),z.logWarn("config.url is null, please get url and run player._startInit(url)"),this.config.nullUrlStart))){this.handleSource&&(this._detachSourceEvents(this.media),f.typeOf(e)==="Array"&&e.length>0?this._attachSourceEvents(this.media,e):!this.media.src||this.media.src!==e?this.media.src=e:e||this.media.removeAttribute("src")),f.typeOf(this.config.volume)==="Number"&&(this.volume=this.config.volume);var n=this.innerContainer?this.innerContainer:this.root;this.media instanceof window.Element&&!n.contains(this.media)&&n.insertBefore(this.media,n.firstChild);var r=this.media.readyState;z.logInfo("_startInit readyState",r),this.config.autoplay&&(!f.isMSE(this.media)&&this.load(),(w.os.isIpad||w.os.isPhone)&&this.mediaPlay());var a=this.config.startTime;this.__startTime=a>0?a:-1,this.config.startTime=0,r>=2&&this.duration>0?this.canPlayFunc():this.on(Ee,this.canPlayFunc),(!this.hasStart||this.state<D.ATTACHED)&&G.afterInit(this),this.hasStart=!0,this.setState(D.ATTACHED),f.setTimeout(this,function(){t.emit(zt)},0)}}},{key:"_registerPlugins",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._loadingPlugins=[];var n=this.config.ignores||[],r=this.config.plugins||[],a=this.config.i18n||[];t&&Ce.extend(a,this.__i18n);var u=n.join("||").toLowerCase().split("||"),c=this.plugins;r.forEach(function(h){try{var g=h.plugin?h.plugin.pluginName:h.pluginName;if(g&&u.indexOf(g.toLowerCase())>-1)return null;if(!t&&c[g.toLowerCase()])return;if(h.lazy&&h.loader){var v=G.lazyRegister(e,h);h.forceBeforeInit&&(v.then(function(){e._loadingPlugins.splice(e._loadingPlugins.indexOf(v),1)}).catch(function(d){z.logError("_registerPlugins:loadingPlugin",d),e._loadingPlugins.splice(e._loadingPlugins.indexOf(v),1)}),e._loadingPlugins.push(v));return}return e.registerPlugin(h)}catch(d){z.logError("_registerPlugins:",d)}})}},{key:"_registerPresets",value:function(){var e=this;this.config.presets.forEach(function(t){Mn(e,t)})}},{key:"_getRootByPosition",value:function(e){var t=null;switch(e){case W.ROOT_RIGHT:this.rightBar||(this.rightBar=f.createPositionBar("xg-right-bar",this.root)),t=this.rightBar;break;case W.ROOT_LEFT:this.leftBar||(this.leftBar=f.createPositionBar("xg-left-bar",this.root)),t=this.leftBar;break;case W.ROOT_TOP:this.topBar||(this.topBar=f.createPositionBar("xg-top-bar",this.root),this.config.topBarAutoHide&&f.addClass(this.topBar,p.TOP_BAR_AUTOHIDE)),t=this.topBar;break;default:t=this.innerContainer||this.root;break}return t}},{key:"registerPlugin",value:function(e,t){var n=G.formatPluginInfo(e,t),r=n.PLUFGIN,a=n.options,u=this.config.plugins,c=G.checkPluginIfExits(r.pluginName,u);!c&&u.push(r);var h=G.getRootByConfig(r.pluginName,this.config);h.root&&(a.root=h.root),h.position&&(a.position=h.position);var g=a.position?a.position:a.config&&a.config.position||r.defaultConfig&&r.defaultConfig.position;return!a.root&&typeof g=="string"&&g.indexOf("controls")>-1?this.controls&&this.controls.registerPlugin(r,a,r.pluginName):(a.root||(a.root=this._getRootByPosition(g)),G.register(this,r,a))}},{key:"deregister",value:function(e){typeof e=="string"?G.unRegister(this,e):e instanceof We&&G.unRegister(this,e.pluginName)}},{key:"unRegisterPlugin",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this.deregister(e),t&&this.removePluginFromConfig(e)}},{key:"removePluginFromConfig",value:function(e){var t;if(typeof e=="string"?t=e:e instanceof We&&(t=e.pluginName),!!t)for(var n=this.config.plugins.length-1;n>-1;n--){var r=this.config.plugins[n];if(r.pluginName.toLowerCase()===t.toLowerCase()){this.config.plugins.splice(n,1);break}}}},{key:"plugins",get:function(){return G.getPlugins(this)}},{key:"getPlugin",value:function(e){var t=G.findPlugin(this,e);return t&&t.pluginName?t:null}},{key:"addClass",value:function(e){this.root&&(f.hasClass(this.root,e)||f.addClass(this.root,e))}},{key:"removeClass",value:function(e){this.root&&f.removeClass(this.root,e)}},{key:"hasClass",value:function(e){if(this.root)return f.hasClass(this.root,e)}},{key:"setAttribute",value:function(e,t){this.root&&this.root.setAttribute(e,t)}},{key:"removeAttribute",value:function(e,t){this.root&&this.root.removeAttribute(e,t)}},{key:"start",value:function(e){var t=this;if(!(this.state>D.ATTACHING))return!e&&!this.config.url&&this.getInitDefinition(),this.hasStart=!0,this.setState(D.ATTACHING),this._registerPlugins(!1),G.beforeInit(this).then(function(){if(t.config){e||(e=t.url||t.config.url);var n=t._preProcessUrl(e),r=t._startInit(n.url);return r}}).catch(function(n){throw n.fileName="player",n.lineNumber="236",z.logError("start:beforeInit:",n),n})}},{key:"switchURL",value:function(e,t){var n=this,r=e;f.typeOf(e)==="Object"&&(r=e.url),r=this._preProcessUrl(r).url;var a=this.currentTime;this.__startTime=a;var u=this.paused&&!this.isError;return this.src=r,new Promise(function(c,h){var g=function(y){n.off("timeupdate",v),n.off("canplay",v),h(y)},v=function(){n.duration>0&&n.__startTime>0&&(n.currentTime=n.__startTime,n.__startTime=-1),u&&n.pause(),n.off("error",g),c(!0)};if(n.once("error",g),!r){n.errorHandler("error",{code:6,message:"empty_src"});return}w.os.isAndroid?n.once("timeupdate",v):n.once("canplay",v),n.play()})}},{key:"videoPlay",value:function(){this.mediaPlay()}},{key:"mediaPlay",value:function(){var e=this;if(!this.hasStart&&this.state<D.ATTACHED){this.removeClass(p.NO_START),this.addClass(p.ENTER),this.start(),this._useAutoplay=!0;return}this.state<D.RUNNING&&(this.removeClass(p.NO_START),!this.isCanplay&&this.addClass(p.ENTER));var t=P(I(s.prototype),"play",this).call(this);return t!==void 0&&t&&t.then?t.then(function(){e.removeClass(p.NOT_ALLOW_AUTOPLAY),e.addClass(p.PLAYING),e.state<D.RUNNING&&(z.logInfo(">>>>playPromise.then"),e.setState(D.RUNNING),e.emit(Ke))}).catch(function(n){if(z.logWarn(">>>>playPromise.catch",n.name),e.media&&e.media.error){e.onError(),e.removeClass(p.ENTER);return}n.name==="NotAllowedError"&&(e._errorTimer=f.setTimeout(e,function(){e._errorTimer=null,e.emit(Oi),e.addClass(p.NOT_ALLOW_AUTOPLAY),e.removeClass(p.ENTER),e.pause(),e.setState(D.NOTALLOW)},0))}):(z.logWarn("video.play not return promise"),this.state<D.RUNNING&&(this.setState(D.RUNNING),this.removeClass(p.NOT_ALLOW_AUTOPLAY),this.removeClass(p.NO_START),this.removeClass(p.ENTER),this.addClass(p.PLAYING),this.emit(Ke))),t}},{key:"mediaPause",value:function(){P(I(s.prototype),"pause",this).call(this)}},{key:"videoPause",value:function(){P(I(s.prototype),"pause",this).call(this)}},{key:"play",value:function(){var e=this;return this.removeClass(p.PAUSED),Ie(this,"play",function(){return e.mediaPlay()})}},{key:"pause",value:function(){var e=this;Ie(this,"pause",function(){P(I(s.prototype),"pause",e).call(e)})}},{key:"seek",value:function(e,t){var n=this;if(!(!this.media||Number.isNaN(Number(e))||!this.hasStart)){var r=this.config,a=r.isSeekedPlay,u=r.seekedStatus,c=t||(a?"play":u);e=e<0?0:e>this.duration?parseInt(this.duration,10):e,!this._isPauseBeforeSeek&&(this._isPauseBeforeSeek=this.paused?2:1),this._onceSeekCanplay&&this.off(Xe,this._onceSeekCanplay),this._onceSeekCanplay=function(){switch(n.removeClass(p.ENTER),n.isSeeking=!1,c){case"play":n.play();break;case"pause":n.pause();break;default:n._isPauseBeforeSeek>1||n.paused?n.pause():n.play()}n._isPauseBeforeSeek=0,n._onceSeekCanplay=null},this.once(Xe,this._onceSeekCanplay),this.state<D.RUNNING?(this.removeClass(p.NO_START),this.currentTime=e,this.play()):this.currentTime=e}}},{key:"getInitDefinition",value:function(){var e=this,t=this.config,n=t.definition,r=t.url;!r&&n&&n.list&&n.list.length>0&&n.defaultDefinition&&n.list.map(function(a){a.definition===n.defaultDefinition&&(e.config.url=a.url,e.curDefinition=a)})}},{key:"changeDefinition",value:function(e,t){var n=this,r=this.config.definition;if(Array.isArray(r==null?void 0:r.list)&&r.list.forEach(function(u){(e==null?void 0:e.definition)===u.definition&&(n.curDefinition=u)}),e!=null&&e.bitrate&&typeof e.bitrate!="number"&&(e.bitrate=parseInt(e.bitrate,10)||0),this.emit(Vt,{from:t,to:e}),!this.hasStart){this.config.url=e.url;return}var a=this.switchURL(e.url,se({seamless:r.seamless!==!1&&typeof MediaSource!="undefined"&&typeof MediaSource.isTypeSupported=="function"},e));a&&a.then?a.then(function(){n.emit(dt,{from:t,to:e})}):this.emit(dt,{from:t,to:e})}},{key:"reload",value:function(){this.load(),this.reloadFunc=function(){this.play()},this.once(Ge,this.reloadFunc)}},{key:"resetState",value:function(){var e=this,t=p.NOT_ALLOW_AUTOPLAY,n=p.PLAYING,r=p.NO_START,a=p.PAUSED,u=p.REPLAY,c=p.ENTER,h=p.ENDED,g=p.ERROR,v=p.LOADING,d=[t,n,r,a,u,c,h,g,v];this.hasStart=!1,this.isError=!1,this._useAutoplay=!1,this.mediaPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,d.forEach(function(y){e.removeClass(y)}),this.addClass(p.NO_START),this.emit(Ni)}},{key:"reset",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;this.resetState();var r=this.plugins;if(r&&(t.map(function(u){e.deregister(u)}),n)){var a=At();Object.keys(this.config).keys(function(u){e.config[u]!=="undefined"&&(u==="plugins"||u==="presets"||u==="el"||u==="id")&&(e.config[u]=a[u])})}}},{key:"destroy",value:function(){var e,t=this,n=this.innerContainer,r=this.root,a=this.media;if(!(!r||!a)){if(this.hasStart=!1,this._useAutoplay=!1,r.removeAttribute(pe),this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.media),f.clearAllTimers(this),this.emit(Fi),(e=he)===null||e===void 0||e.remove(this),G.destroy(this),Mi(this),P(I(s.prototype),"destroy",this).call(this),this.fullscreen&&this._fullscreenEl===this.root&&this.exitFullscreen(),n)for(var u=n.children,c=0;c<u.length;c++)n.removeChild(u[c]);!n&&a instanceof window.Node&&r.contains(a)&&r.removeChild(a),["topBar","leftBar","rightBar","innerContainer"].map(function(g){t[g]&&r.removeChild(t[g]),t[g]=null});var h=r.className.split(" ");h.length>0?r.className=h.filter(function(g){return g.indexOf("xgplayer")<0}).join(" "):r.className="",this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach(function(g){t[g]=!1})}}},{key:"replay",value:function(){var e=this;this.removeClass(p.ENDED),this.currentTime=0,this.isSeeking=!1,Ie(this,"replay",function(){e.once(Xe,function(){var t=e.mediaPlay();t&&t.catch&&t.catch(function(n){console.log(n)})}),e.emit(Ui),e.onPlay()})}},{key:"retry",value:function(){var e=this;this.removeClass(p.ERROR),this.addClass(p.LOADING),Ie(this,"retry",function(){var t=e.currentTime,n=e.config.url,r=f.isMSE(e.media)?{url:n}:e._preProcessUrl(n);e.src=r.url,!e.config.isLive&&(e.currentTime=t),e.once(Ee,function(){e.mediaPlay()})})}},{key:"changeFullStyle",value:function(e,t,n,r){e&&(r||(r=p.PARENT_FULLSCREEN),this._orgCss||(this._orgCss=f.filterStyleFromText(e)),f.addClass(e,n),t&&t!==e&&!this._orgPCss&&(this._orgPCss=f.filterStyleFromText(t),f.addClass(t,r),t.setAttribute(pe,this.playerId)))}},{key:"recoverFullStyle",value:function(e,t,n,r){r||(r=p.PARENT_FULLSCREEN),this._orgCss&&(f.setStyleFromCsstext(e,this._orgCss),this._orgCss=""),f.removeClass(e,n),t&&t!==e&&this._orgPCss&&(f.setStyleFromCsstext(t,this._orgPCss),this._orgPCss="",f.removeClass(t,r),t.removeAttribute(pe))}},{key:"getFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget,t=this.root,n=this.media;(e==="video"||e==="media")&&(e=this[e]),e||(e=t),this._fullScreenOffset={top:f.scrollTop(),left:f.scrollLeft()},this._fullscreenEl=e,this._fullActionFrom="get";var r=f.getFullScreenEl();if(r===this._fullscreenEl)return this.onFullscreenChange(),Promise.resolve();try{for(var a=0;a<Rt.length;a++){var u=Rt[a];if(e[u]){var c=u==="webkitRequestFullscreen"?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):e[u]();return c&&c.then?c:Promise.resolve()}}return n.fullscreenEnabled||n.webkitSupportsFullscreen?(n.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch(h){return Promise.reject(new Error("call getFullscreen fail"))}}},{key:"exitFullscreen",value:function(e){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),!(!this._fullscreenEl&&!f.getFullScreenEl())){this.root;var t=this.media;this._fullActionFrom="exit";try{for(var n=0;n<Dt.length;n++){var r=Dt[n];if(document[r]){var a=document[r]();return a&&a.then?a:Promise.resolve()}}return t&&t.webkitSupportsFullscreen?(t.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch(u){return Promise.reject(new Error("call exitFullscreen fail"))}}}},{key:"getCssFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget;this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();var t=e?"".concat(p.INNER_FULLSCREEN," ").concat(p.CSS_FULLSCREEN):p.CSS_FULLSCREEN;this.changeFullStyle(this.root,e,t);var n=this.config.fullscreen,r=n===void 0?{}:n,a=r.useCssFullscreen===!0||typeof r.useCssFullscreen=="function"&&r.useCssFullscreen();a&&(this.fullscreen=!0,this.emit(ve,!0)),this._cssfullscreenEl=e,this.cssfullscreen=!0,this.emit(gt,!0)}},{key:"exitCssFullscreen",value:function(){var e=this._cssfullscreenEl?"".concat(p.INNER_FULLSCREEN," ").concat(p.CSS_FULLSCREEN):p.CSS_FULLSCREEN;if(!this.fullscreen)this.recoverFullStyle(this.root,this._cssfullscreenEl,e);else{var t=this.config.fullscreen,n=t===void 0?{}:t,r=n.useCssFullscreen===!0||typeof n.useCssFullscreen=="function"&&n.useCssFullscreen();r?(this.recoverFullStyle(this.root,this._cssfullscreenEl,e),this.fullscreen=!1,this.emit(ve,!1)):this.removeClass(e)}this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(gt,!1)}},{key:"getRotateFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget;this.cssfullscreen&&this.exitCssFullscreen(e);var t=e?"".concat(p.INNER_FULLSCREEN," ").concat(p.ROTATE_FULLSCREEN):p.ROTATE_FULLSCREEN;this._fullscreenEl=e||this.root,this.changeFullStyle(this.root,e,t,p.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this._rootStyle=this.root.getAttribute("style"),this.root.style.width="".concat(window.innerHeight,"px"),this.emit(ve,!0)}},{key:"exitRotateFullscreen",value:function(e){var t=this._fullscreenEl!==this.root?"".concat(p.INNER_FULLSCREEN," ").concat(p.ROTATE_FULLSCREEN):p.ROTATE_FULLSCREEN;this.recoverFullStyle(this.root,this._fullscreenEl,t,p.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(ve,!1),this._rootStyle&&(this.root.style.style=this._rootStyle,this._rootStyle=!1)}},{key:"setRotateDeg",value:function(e){window.orientation===90||window.orientation===-90?this.rotateDeg=0:this.rotateDeg=e}},{key:"focus",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{autoHide:!this.config.closeDelayBlur,delay:this.config.inactive};if(this.isActive){this.onFocus(e);return}this.emit($t,se({paused:this.paused,ended:this.ended},e))}},{key:"blur",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{ignorePaused:!1};if(!this.isActive){this.onBlur(e);return}this._clearUserTimer(),this.emit(Bi,se({paused:this.paused,ended:this.ended},e))}},{key:"onFocus",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{autoHide:!0,delay:3e3},n=this.innerStates;if(this.isActive=!0,this.removeClass(p.INACTIVE),this._clearUserTimer(),t.isLock!==void 0&&(n.isActiveLocked=t.isLock),t.autoHide===!1||t.isLock===!0||n.isActiveLocked){this._clearUserTimer();return}var r=t&&t.delay?t.delay:this.config.inactive;this.userTimer=f.setTimeout(this,function(){e.userTimer=null,e.blur()},r)}},{key:"onBlur",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.ignorePaused,n=t===void 0?!1:t;if(!this.innerStates.isActiveLocked){var r=this.config.closePauseVideoFocus;this.isActive=!1,(n||r||!this.paused&&!this.ended)&&this.addClass(p.INACTIVE)}}},{key:"onEmptied",value:function(){this.updateAcc("emptied")}},{key:"onCanplay",value:function(){this.removeClass(p.ENTER),this.removeClass(p.ERROR),this.removeClass(p.LOADING),this.isCanplay=!0,this.waitTimer&&f.clearTimeout(this,this.waitTimer)}},{key:"onLoadeddata",value:function(){this.isError=!1,this.isSeeking=!1,this.__startTime>0&&this.duration>0&&(this.currentTime=this.__startTime,this.__startTime=-1)}},{key:"onLoadstart",value:function(){this.removeClass(p.ERROR),this.isCanplay=!1}},{key:"onPlay",value:function(){this.state===D.ENDED&&this.setState(D.RUNNING),this.removeClass(p.PAUSED),this.ended&&this.removeClass(p.ENDED),!this.config.closePlayVideoFocus&&this.focus()}},{key:"onPause",value:function(){this.addClass(p.PAUSED),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this._clearUserTimer(),this.focus())}},{key:"onEnded",value:function(){this.updateAcc("ended"),this.addClass(p.ENDED),this.setState(D.ENDED)}},{key:"onError",value:function(){this.isError=!0,this.updateAcc("error"),this.removeClass(p.NOT_ALLOW_AUTOPLAY),this.removeClass(p.NO_START),this.removeClass(p.ENTER),this.removeClass(p.LOADING),this.addClass(p.ERROR)}},{key:"onSeeking",value:function(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(p.SEEKING)}},{key:"onSeeked",value:function(){this.isSeeking=!1,this.waitTimer&&f.clearTimeout(this,this.waitTimer),this.removeClass(p.LOADING),this.removeClass(p.SEEKING)}},{key:"onWaiting",value:function(){var e=this;this.waitTimer&&f.clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=f.setTimeout(this,function(){e.addClass(p.LOADING),e.emit(Hi),f.clearTimeout(e,e.waitTimer),e.waitTimer=null},this.config.minWaitDelay)}},{key:"onPlaying",value:function(){var e=this;this.isError=!1;var t=p.NO_START,n=p.PAUSED,r=p.ENDED,a=p.ERROR,u=p.REPLAY,c=p.LOADING,h=[t,n,r,a,u,c];h.forEach(function(g){e.removeClass(g)}),!this._accPlayed.t&&!this.paused&&!this.ended&&(this._accPlayed.t=new Date().getTime())}},{key:"onTimeupdate",value:function(){!this._videoHeight&&this.media.videoHeight&&this.resize(),(this.waitTimer||this.hasClass(p.LOADING))&&this.media.readyState>2&&(this.removeClass(p.LOADING),f.clearTimeout(this,this.waitTimer),this.waitTimer=null),!this.paused&&this.state===D.NOTALLOW&&this.duration&&(this.setState(D.RUNNING),this.emit(Ke)),!this._accPlayed.t&&!this.paused&&!this.ended&&(this._accPlayed.t=new Date().getTime())}},{key:"onVolumechange",value:function(){f.typeOf(this.config.volume)==="Number"&&(this.config.volume=this.volume)}},{key:"onRatechange",value:function(){this.config.defaultPlaybackRate=this.playbackRate}},{key:"emitUserAction",value:function(e,t,n){if(!(!this.media||!t||!e)){var r=f.typeOf(e)==="String"?e:e.type||"";n.props&&f.typeOf(n.props)!=="Array"&&(n.props=[n.props]),this.emit(ft,se({eventType:r,action:t,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:e},n))}}},{key:"updateAcc",value:function(e){if(this._accPlayed.t){var t=new Date().getTime()-this._accPlayed.t;this._accPlayed.acc+=t,this._accPlayed.t=0,(e==="ended"||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}},{key:"checkBuffer",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{startDiff:0,endDiff:0},n=t||{},r=n.startDiff,a=r===void 0?0:r,u=n.endDiff,c=u===void 0?0:u,h=this.media.buffered;if(!h||h.length===0||!this.duration)return!0;for(var g=e||this.media.currentTime||.2,v=h.length,d=0;d<v;d++)if(h.start(d)+a<=g&&h.end(d)-c>g)return!0;return!1}},{key:"resizePosition",value:function(){var e=this.videoPos,t=e.vy,n=e.vx,r=e.h,a=e.w,u=this.videoPos.rotate;if(!(u<0&&r<0&&a<0)){var c=this.videoPos._pi;if(!c&&this.media.videoHeight&&(c=this.media.videoWidth/this.media.videoHeight*100),!!c){this.videoPos.pi=c,u=u<0?0:u;var h={rotate:u},g=0,v=0,d=1,y=Math.abs(u/90),m=this.root,_=this.innerContainer,T=m.offsetWidth,E=_?_.offsetHeight:m.offsetHeight,R=E,S=T;if(y%2===0)d=r>0?100/r:a>0?100/a:1,h.scale=d,g=t>0?(100-r)/2-t:0,h.y=y===2?0-g:g,v=n>0?(100-a)/2-n:0,h.x=y===2?0-v:v,this.media.style.width="".concat(S,"px"),this.media.style.height="".concat(R,"px");else if(y%2===1){S=E,R=T;var x=E-T;v=-x/2/S*100,h.x=y===3?v+t/2:v-t/2,g=x/2/R*100,h.y=y===3?g+n/2:g-n/2,h.scale=d,this.media.style.width="".concat(S,"px"),this.media.style.height="".concat(R,"px")}var b=f.getTransformStyle(h,this.media.style.transform||this.media.style.webkitTransform);this.media.style.transform=b,this.media.style.webkitTransform=b}}}},{key:"position",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{h:0,y:0,x:0,w:0};if(!(!this.media||!e||!e.h)){var t=this.videoPos;t.h=e.h*100||0,t.w=e.w*100||0,t.vx=e.x*100||0,t.vy=e.y*100||0,this.resizePosition()}}},{key:"setConfig",value:function(e){var t=this;e&&Object.keys(e).map(function(n){if(n!=="plugins"){t.config[n]=e[n];var r=t.plugins[n.toLowerCase()];r&&f.typeOf(r.setConfig)==="Function"&&r.setConfig(e[n])}})}},{key:"playNext",value:function(e){var t=this;this.resetState(),this.setConfig(e),this._currentTime=0,this._duration=0,Ie(this,"playnext",function(){t.start(),t.emit(nt,e)})}},{key:"resize",value:function(){var e=this;if(this.media){var t=this.root.getBoundingClientRect();this.sizeInfo.width=t.width,this.sizeInfo.height=t.height,this.sizeInfo.left=t.left,this.sizeInfo.top=t.top;var n=this.media,r=n.videoWidth,a=n.videoHeight,u=this.config,c=u.fitVideoSize,h=u.videoFillMode;if((h==="fill"||h==="cover"||h==="contain")&&this.setAttribute("data-xgfill",h),!(!a||!r)){this._videoHeight=a,this._videoWidth=r;var g=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,v=t.width,d=t.height-g,y=parseInt(r/a*1e3,10),m=parseInt(v/d*1e3,10),_=v,T=d,E={};c==="auto"&&m>y||c==="fixWidth"?(T=v/y*1e3,this.config.fluid?E.paddingTop="".concat(T*100/_,"%"):E.height="".concat(T+g,"px")):(c==="auto"&&m<y||c==="fixHeight")&&(_=y*d/1e3,E.width="".concat(_,"px")),!this.fullscreen&&!this.cssfullscreen&&Object.keys(E).forEach(function(S){e.root.style[S]=E[S]}),(h==="fillHeight"&&m<y||h==="fillWidth"&&m>y)&&this.setAttribute("data-xgfill","cover");var R={videoScale:y,vWidth:_,vHeight:T,cWidth:_,cHeight:T+g};this.resizePosition(),this.emit(be,R)}}}},{key:"updateObjectPosition",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(this.media.updateObjectPosition){this.media.updateObjectPosition(e,t);return}this.media.style.objectPosition="".concat(e*100,"% ").concat(t*100,"%")}},{key:"setState",value:function(e){z.logInfo("setState","state from:".concat(vt[this.state]," to:").concat(vt[e])),this._state=e}},{key:"_preProcessUrl",value:function(e,t){var n=this.config,r=n.preProcessUrl,a=n.preProcessUrlOptions,u=Object.assign({},a,t);return!f.isBlob(e)&&typeof r=="function"?r(e,u):{url:e}}},{key:"state",get:function(){return this._state}},{key:"isFullscreen",get:function(){return this.fullscreen}},{key:"isCssfullScreen",get:function(){return this.cssfullscreen}},{key:"hasStart",get:function(){return this._hasStart},set:function(e){typeof e=="boolean"&&(this._hasStart=e,e===!1&&this.setState(D.READY),this.emit("hasstart"))}},{key:"isPlaying",get:function(){return this._state===D.RUNNING||this._state===D.ENDED},set:function(e){e?this.setState(D.RUNNING):this._state>=D.RUNNING&&this.setState(D.ATTACHED)}},{key:"definitionList",get:function(){return!this.config||!this.config.definition?[]:this.config.definition.list||[]},set:function(e){var t=this,n=this.config.definition,r=null,a=null;n.list=e,this.emit("resourceReady",e),e.forEach(function(u){var c;((c=t.curDefinition)===null||c===void 0?void 0:c.definition)===u.definition&&(r=u),n.defaultDefinition===u.definition&&(a=u)}),!a&&e.length>0&&(a=e[0]),r?this.changeDefinition(r):a&&this.changeDefinition(a)}},{key:"videoFrameInfo",get:function(){var e={total:0,dropped:0,corrupted:0,droppedRate:0,droppedDuration:0};if(!this.media||!this.media.getVideoPlaybackQuality)return e;var t=this.media.getVideoPlaybackQuality();return e.dropped=t.droppedVideoFrames||0,e.total=t.totalVideoFrames||0,e.corrupted=t.corruptedVideoFrames||0,e.total>0&&(e.droppedRate=e.dropped/e.total*100,e.droppedDuration=parseInt(this.cumulateTime/e.total*e.dropped,0)),e}},{key:"lang",get:function(){return this.config.lang},set:function(e){var t=Ce.langKeys.filter(function(n){return n===e});if(t.length===0&&e!=="zh"){console.error("Sorry, set lang fail, because the language [".concat(e,"] is not supported now, list of all supported languages is [").concat(Ce.langKeys.join(),"] "));return}this.config.lang=e,G.setLang(e,this)}},{key:"i18n",get:function(){var e=this.config.lang;return e==="zh"&&(e="zh-cn"),this.__i18n.lang[e]||this.__i18n.lang.en}},{key:"i18nKeys",get:function(){return this.__i18n.textKeys||{}}},{key:"version",get:function(){return rt}},{key:"playerId",get:function(){return this._pluginInfoId}},{key:"url",get:function(){return this.__url||this.config.url},set:function(e){this.__url=e}},{key:"poster",get:function(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster},set:function(e){this.plugins.poster&&this.plugins.poster.update(e)}},{key:"readyState",get:function(){return P(I(s.prototype),"readyState",this)}},{key:"error",get:function(){var e=P(I(s.prototype),"error",this);return this.i18n[e]||e}},{key:"networkState",get:function(){return P(I(s.prototype),"networkState",this)}},{key:"fullscreenChanging",get:function(){return this._fullScreenOffset!==null}},{key:"cumulateTime",get:function(){var e=this._accPlayed,t=e.acc,n=e.t;return n?new Date().getTime()-n+t:t}},{key:"zoom",get:function(){return this.config.zoom},set:function(e){this.config.zoom=e}},{key:"videoRotateDeg",get:function(){return this.videoPos.rotate},set:function(e){e=f.convertDeg(e),!(e%90!==0||e===this.videoPos.rotate)&&(this.videoPos.rotate=e,this.resizePosition())}},{key:"avgSpeed",get:function(){return Ot},set:function(e){Ot=e}},{key:"realTimeSpeed",get:function(){return Lt},set:function(e){Lt=e}},{key:"offsetCurrentTime",get:function(){return this._offsetInfo.currentTime||0},set:function(e){this._offsetInfo.currentTime=e}},{key:"offsetDuration",get:function(){return this._offsetInfo.duration||0},set:function(e){this._offsetInfo.duration=e||0}},{key:"hook",value:function(e,t){return pt.call.apply(pt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,t){return mt.call.apply(mt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,t){return yt.call.apply(yt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"usePluginHooks",value:function(e,t,n){for(var r=arguments.length,a=new Array(r>3?r-3:0),u=3;u<r;u++)a[u-3]=arguments[u];return _t.call.apply(_t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removePluginHooks",value:function(e,t,n){for(var r=arguments.length,a=new Array(r>3?r-3:0),u=3;u<r;u++)a[u-3]=arguments[u];return Et.call.apply(Et,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"setUserActive",value:function(e,t){var n;typeof t=="boolean"&&t!==this.muted&&(this.addInnerOP("volumechange"),f.typeOf(t)===Boolean&&(this.muted=t)),(n=he)===null||n===void 0||n.setActive(this.playerId,e)}}],[{key:"debugger",get:function(){return z.config.debug},set:function(e){z.config.debug=e}},{key:"instManager",get:function(){return he},set:function(e){he=e}},{key:"getCurrentUserActivePlayerId",value:function(){var e;return(e=he)===null||e===void 0?void 0:e.getActiveId()}},{key:"setCurrentUserActive",value:function(e,t){var n;(n=he)===null||n===void 0||n.setActive(e,t)}},{key:"isHevcSupported",value:function(){return w.isHevcSupported()}},{key:"probeConfigSupported",value:function(e){return w.probeConfigSupported(e)}},{key:"install",value:function(e,t){s.plugins||(s.plugins={}),s.plugins[e]||(s.plugins[e]=t)}},{key:"use",value:function(e,t){s.plugins||(s.plugins={}),s.plugins[e]=t}}]),s}(An);k(Le,"defaultPreset",null);k(Le,"XgVideoProxy",null);Le.instManager=ti.getInstance();var Nt=function(l){F(s,l);var o=M(s);function s(){return L(this,s),o.apply(this,arguments)}return A(s,[{key:"afterCreate",value:function(){this.getMini=this.getMini.bind(this),this.exitMini=this.exitMini.bind(this),this.bind("click",this.getMini)}},{key:"getMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"exitMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){var e="MINISCREEN";return`
      <xg-icon class="xgplayer-miniicon">
      <div class="xgplayer-icon btn-text"><span class="icon-text" lang-key="`.concat(this.i18nKeys[e],'">').concat(this.i18n[e],`</span></div>
      </xg-icon>`)}}],[{key:"pluginName",get:function(){return"miniscreenIcon"}},{key:"defaultConfig",get:function(){return{position:W.CONTROLS_RIGHT,index:10}}}]),s}(J);function Ft(l){var o=parseFloat(l),s=l.indexOf("%")===-1&&!Number.isNaN(o);return s&&o}var ct=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],ii=ct.length;function zn(){for(var l={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},o=0;o<ii;o++){var s=ct[o];l[s]=0}return l}function Vn(l){var o=window.getComputedStyle(l);return o}function Mt(l){if(typeof l=="string"&&(l=document.querySelector(l)),!(!l||Yt(l)!=="object"||!l.nodeType)){var o=Vn(l);if(o.display==="none")return zn();var s={};s.width=l.offsetWidth,s.height=l.offsetHeight;for(var i=s.isBorderBox=o.boxSizing==="border-box",e=0;e<ii;e++){var t=ct[e],n=o[t],r=parseFloat(n);s[t]=Number.isNaN(r)?0:r}var a=s.paddingLeft+s.paddingRight,u=s.paddingTop+s.paddingBottom,c=s.marginLeft+s.marginRight,h=s.marginTop+s.marginBottom,g=s.borderLeftWidth+s.borderRightWidth,v=s.borderTopWidth+s.borderBottomWidth,d=i,y=Ft(o.width);y!==!1&&(s.width=y+(d?0:a+g));var m=Ft(o.height);return m!==!1&&(s.height=m+(d?0:u+v)),s.innerWidth=s.width-(a+g),s.innerHeight=s.height-(u+v),s.outerWidth=s.width+c,s.outerHeight=s.height+h,s}}function et(l,o){for(var s=0;s<l.length;s++){var i=l[s];if(i.identifier===o)return i}}var tt={START:"dragStart",MOVE:"dragMove",ENDED:"dragEnded"},Bt={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]},$n=function(l){F(s,l);var o=M(s);function s(i){var e,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return L(this,s),e=o.call(this),e.isEnabled=!0,e.isDragging=!1,e.isDown=!1,e.position={},e.downPoint={},e.dragPoint={x:0,y:0},e.startPos={x:0,y:0},e._root=i instanceof Element?i:document.querySelector(i),e._handlerDom=t.handle instanceof Element?t.handle:document.querySelector(t.handle),!e._root||!e._handlerDom?jt(e):(e._bindStartEvent(),e)}return A(s,[{key:"_bindStartEvent",value:function(){var e=this;"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this["on".concat(this._startKey)]=this["on".concat(this._startKey)].bind(this),this._handlerDom.addEventListener(this._startKey,this["on".concat(this._startKey)]),Bt[this._startKey].map(function(t){e["on".concat(t)]=e["on".concat(t)].bind(e)})}},{key:"_unbindStartEvent",value:function(){this._handlerDom.removeEventListener(this._startKey,this["on".concat(this._startKey)])}},{key:"_bindPostStartEvents",value:function(e){var t=this;if(e){var n=Bt[this._startKey];n.map(function(r){window.addEventListener(r,t["on".concat(r)])}),this._boundPointerEvents=n}}},{key:"_unbindPostStartEvents",value:function(){var e=this;this._boundPointerEvents&&(this._boundPointerEvents.map(function(t){window.removeEventListener(t,e["on".concat(t)])}),delete this._boundPointerEvents)}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1,this.isDragging&&this.onUp()}},{key:"onDocUp",value:function(e){this.onUp()}},{key:"animate",value:function(){var e=this;this.isDragging&&(this.positionDrag(),window.requestAnimationFrame(function(){e.animate()}))}},{key:"positionDrag",value:function(){var e="translate3d(".concat(this.dragPoint.x,"px, ").concat(this.dragPoint.y,"px, 0)");this._root.style.transform=e,this._root.style.webKitTransform=e}},{key:"setLeftTop",value:function(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}},{key:"onmousedown",value:function(e){this.dragStart(e,e)}},{key:"onmousemove",value:function(e){this.dragMove(e,e)}},{key:"onmouseup",value:function(e){this.dragEnd(e,e)}},{key:"ontouchstart",value:function(e){var t=e.changedTouches[0];this.dragStart(e,t),this.touchIdentifier=t.pointerId!==void 0?t.pointerId:t.identifier,e.preventDefault()}},{key:"ontouchmove",value:function(e){var t=et(e.changedTouches,this.touchIdentifier);t&&this.dragMove(e,t)}},{key:"ontouchend",value:function(e){var t=et(e.changedTouches,this.touchIdentifier);t&&this.dragEnd(e,t),e.preventDefault()}},{key:"ontouchcancel",value:function(e){var t=et(e.changedTouches,this.touchIdentifier);t&&this.dragCancel(e,t)}},{key:"dragStart",value:function(e,t){if(!(!this._root||this.isDown||!this.isEnabled)){this.downPoint=t,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();var n=Mt(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-n.height,this.startPos.maxX=window.innerWidth-n.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(e)}}},{key:"dragRealStart",value:function(e,t){this.isDragging=!0,this.animate(),this.emit(tt.START,this.startPos)}},{key:"dragEnd",value:function(e,t){this._root&&(this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(tt.ENDED)),this.presetInfo())}},{key:"_dragPointerMove",value:function(e,t){var n={x:t.pageX-this.downPoint.pageX,y:t.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(n)&&this.dragRealStart(e,t),n}},{key:"dragMove",value:function(e,t){if(e=e||window.event,!!this.isDown){var n=this.startPos,r=n.x,a=n.y,u=this._dragPointerMove(e,t),c=u.x,h=u.y;c=this.checkContain("x",c,r),h=this.checkContain("y",h,a),this.position.x=r+c,this.position.y=a+h,this.dragPoint.x=c,this.dragPoint.y=h,this.emit(tt.MOVE,this.position)}}},{key:"dragCancel",value:function(e,t){this.dragEnd(e,t)}},{key:"presetInfo",value:function(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}},{key:"destroy",value:function(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}},{key:"hasDragStarted",value:function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3}},{key:"checkContain",value:function(e,t,n){return t+n<0?0-n:e==="x"&&t+n>this.startPos.maxX?this.startPos.maxX-n:e==="y"&&t+n>this.startPos.maxY?this.startPos.maxY-n:t}},{key:"_getPosition",value:function(){var e=window.getComputedStyle(this._root),t=this._getPositionCoord(e.left,"width"),n=this._getPositionCoord(e.top,"height");this.position.x=Number.isNaN(t)?0:t,this.position.y=Number.isNaN(n)?0:n,this._addTransformPosition(e)}},{key:"_addTransformPosition",value:function(e){var t=e.transform;if(t.indexOf("matrix")===0){var n=t.split(","),r=t.indexOf("matrix3d")===0?12:4,a=parseInt(n[r],10),u=parseInt(n[r+1],10);this.position.x+=a,this.position.y+=u}}},{key:"_getPositionCoord",value:function(e,t){if(e.indexOf("%")!==-1){var n=Mt(this._root.parentNode);return n?parseFloat(e)/100*n[t]:0}return parseInt(e,10)}}]),s}(Qt),Yn=function(l){F(s,l);var o=M(s);function s(i){var e;L(this,s),e=o.call(this,i),k(C(e),"onCancelClick",function(r){e.exitMini(),e.isClose=!0}),k(C(e),"onCenterClick",function(r){var a=C(e),u=a.player;u.paused?u.play():u.pause()}),k(C(e),"onScroll",function(r){if(!(!window.scrollY&&window.scrollY!==0||Math.abs(window.scrollY-e.pos.scrollY)<50)){var a=parseInt(f.getCss(e.player.root,"height"));a+=e.config.scrollTop,e.pos.scrollY=window.scrollY,window.scrollY>a+5?!e.isMini&&!e.isClose&&e.getMini():window.scrollY<=a&&(e.isMini&&e.exitMini(),e.isClose=!1)}}),e.isMini=!1,e.isClose=!1;var t=C(e),n=t.config;return e.pos={left:n.left<0?window.innerWidth-n.width-20:n.left,top:n.top<0?window.innerHeight-n.height-20:n.top,height:e.config.height,width:e.config.width,scrollY:window.scrollY||0},e.lastStyle=null,e}return A(s,[{key:"beforeCreate",value:function(e){typeof e.player.config.mini=="boolean"&&(e.config.isShowIcon=e.player.config.mini)}},{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.on(at,function(){e.setAttr("data-state","pause")}),this.on(fe,function(){e.setAttr("data-state","play")})}},{key:"onPluginsReady",value:function(){var e=this,t=this.player,n=this.config;if(!n.disable){if(this.config.isShowIcon){var r={config:{onClick:function(){e.getMini()}}};t.controls.registerPlugin(Nt,r,Nt.pluginName)}var a=f.checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",a,this.onCancelClick),this.bind(".play-icon",a,this.onCenterClick),this.config.disableDrag||(this._draggabilly=new $n(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}}},{key:"registerIcons",value:function(){return{play:{icon:Gi,class:"xg-icon-play"},pause:{icon:Wi,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".play-icon",e.play),this.appendChild(".play-icon",e.pause)}},{key:"getMini",value:function(){var e=this;if(!this.isMini){var t=this.player,n=this.playerConfig,r=this.config.target||this.player.root;this.lastStyle={},f.addClass(t.root,"xgplayer-mini"),["width","height","top","left"].map(function(a){e.lastStyle[a]=r.style[a],r.style[a]="".concat(e.pos[a],"px")}),n.fluid&&(r.style["padding-top"]=""),this.emit(it,!0),t.isMini=this.isMini=!0}}},{key:"exitMini",value:function(){var e=this;if(!this.isMini)return!1;var t=this.player,n=this.playerConfig,r=this.config.target||this.player.root;f.removeClass(t.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map(function(a){r.style[a]=e.lastStyle[a]}),this.lastStyle=null,n.fluid&&(t.root.style.width="100%",t.root.style.height="0",t.root.style["padding-top"]="".concat(n.height*100/n.width,"%")),this.emit(it,!1),this.isMini=t.isMini=!1}},{key:"destroy",value:function(){window.removeEventListener("scroll",this.onScroll);var e=f.checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",e,this.onCancelClick),this.unbind(".play-icon",e,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}},{key:"render",value:function(){if(!this.config.disable)return`
      <xg-mini-layer class="xg-mini-layer">
      <xg-mini-header class="xgplayer-mini-header">
      `.concat(Ve(this,"MINI_DRAG",this.playerConfig.isHideTips),`
      </xg-mini-header>
      <div class="mini-cancel-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>
        </svg>
      </div>
      <div class="play-icon">
      </div>
      </xg-mini-layer>`)}}],[{key:"pluginName",get:function(){return"miniscreen"}},{key:"defaultConfig",get:function(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}}]),s}(J),Kn=function(l){F(s,l);var o=M(s);function s(){var i;L(this,s);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i=o.call.apply(o,[this].concat(t)),k(C(i),"_onDurationChange",function(){i.updateSegments();var r=i.player,a=r.currentTime,u=r.timeSegments;if(i._checkIfEnabled(u)){var c=f.getIndexByTime(a,u),h=f.getOffsetCurrentTime(a,u,c);i.player.offsetCurrentTime=h,i.changeIndex(c,u)}}),k(C(i),"_onLoadedData",function(){var r=i.player.timeSegments;if(i._checkIfEnabled(r)){var a=f.getOffsetCurrentTime(0,r);i.player.offsetCurrentTime=a,i.changeIndex(0,r),i.curPos.start>0&&(i.player.currentTime=i.curPos.start)}}),k(C(i),"_onTimeupdate",function(){var r=i.player,a=r.currentTime,u=r.timeSegments;if(i._checkIfEnabled(u)){var c=u.length;i.lastCurrentTime=a;var h=f.getIndexByTime(a,u);h!==i.curIndex&&i.changeIndex(h,u);var g=f.getOffsetCurrentTime(a,u,h);if(i.player.offsetCurrentTime=g,!!i.curPos){var v=i.curPos,d=v.start,y=v.end;a<d?i.player.currentTime=d:a>y&&h>=c-1&&i.player.pause()}}}),k(C(i),"_onSeeking",function(){var r=i.player,a=r.currentTime,u=r.timeSegments;if(i._checkIfEnabled(u))if(a<u[0].start)i.player.currentTime=u[0].start;else if(a>u[u.length-1].end)i.player.currentTime=u[u.length-1].end;else{var c=f.getIndexByTime(a,u);if(c>=0){var h=i.getSeekTime(a,i.lastCurrentTime,c,u);h>=0&&(i.player.currentTime=h)}}}),k(C(i),"_onPlay",function(){var r=i.player,a=r.currentTime,u=r.timeSegments;i._checkIfEnabled(u)&&a>=u[u.length-1].end&&(i.player.currentTime=u[0].start)}),i}return A(s,[{key:"afterCreate",value:function(){this.curIndex=-1,this.curPos=null,this.lastCurrentTime=0,this.updateSegments(),this.on(ot,this._onDurationChange),this.on(Ge,this._onLoadedData),this.on(Ue,this._onTimeupdate),this.on(Kt,this._onSeeking),this.on(fe,this._onPlay)}},{key:"setConfig",value:function(e){var t=this;if(e){var n=Object.keys(e);n.length<1||(n.forEach(function(r){t.config[r]=e[r]}),this.updateSegments())}}},{key:"updateSegments",value:function(){var e=this.config,t=e.disable,n=e.segments,r=this.player;if(t||!n||n.length===0)r.timeSegments=[],r.offsetDuration=0,r.offsetCurrentTime=-1;else{var a=this.formatTimeSegments(n,r.duration);r.timeSegments=a,r.offsetDuration=a.length>0?a[a.length-1].duration:0}}},{key:"formatTimeSegments",value:function(e,t){var n=[];return e?(e.sort(function(r,a){return r.start-a.start}),e.forEach(function(r,a){var u={};if(u.start=r.start<0?0:r.start,u.end=t>0&&r.end>t?t:r.end,!(t>0&&u.start>t)){n.push(u);var c=u.end-u.start;if(a===0)u.offset=r.start,u.cTime=0,u.segDuration=c,u.duration=c;else{var h=n[a-1];u.offset=h.offset+(u.start-h.end),u.cTime=h.duration+h.cTime,u.segDuration=c,u.duration=h.duration+c}}}),n):[]}},{key:"getSeekTime",value:function(e,t,n,r){var a=-1,u=r[n],c=u.start,h=u.end;if(e>=c&&e<=h)return a;var g=e-t;if(g<0&&e<c){var v=t>c?t-c:0;return a=n-1>=0?r[n-1].end+g+v:0,a}return-1}},{key:"_checkIfEnabled",value:function(e){return!(!e||e.length<1)}},{key:"changeIndex",value:function(e,t){this.curIndex=e,e>=0&&t.length>0?this.curPos=t[e]:this.curPos=null}}],[{key:"pluginName",get:function(){return"TimeSegmentsControls"}},{key:"defaultConfig",get:function(){return{disable:!0,segments:[]}}}]),s}(We);function Xn(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none">
  <g clip-path="url(#clip0)">
    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>
    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>
  </g>
  <defs>
    <clipPath id="clip0">
      <rect width="40" height="40" fill="white"/>
    </clipPath>
  </defs>
</svg>
`,"image/svg+xml").firstChild}var qn=function(l){F(s,l);var o=M(s);function s(i){var e;return L(this,s),e=o.call(this,i),e.rotateDeg=e.config.rotateDeg||0,e}return A(s,[{key:"afterCreate",value:function(){var e=this;if(!this.config.disable){P(I(s.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.rotate),this.onBtnClick=this.onBtnClick.bind(this),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(be,function(){e.rotateDeg&&e.config.innerRotate&&f.setTimeout(e,function(){e.updateRotateDeg(e.rotateDeg,e.config.innerRotate)},100)});var t=this.player.root;this.rootWidth=t.style.width||t.offsetWidth||t.clientWidth,this.rootHeight=t.style.height||t.offsetHeight||t.clientHeight,this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate)}}},{key:"destroy",value:function(){P(I(s.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}},{key:"onBtnClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"rotate"),this.rotate(this.config.clockwise,this.config.innerRotate,1)}},{key:"updateRotateDeg",value:function(e,t){if(e||(e=0),t){this.player.videoRotateDeg=e;return}var n=this.player,r=this.rootWidth,a=this.rootHeight,u=n.root,c=n.innerContainer,h=n.media,g=u.offsetWidth,v=c&&t?c.offsetHeight:u.offsetHeight,d=r,y=a,m=0,_=0;(e===.75||e===.25)&&(d="".concat(v,"px"),y="".concat(g,"px"),m=-(v-g)/2,_=-(g-v)/2);var T="translate(".concat(m,"px,").concat(_,"px) rotate(").concat(e,"turn)"),E={transformOrigin:"center center",transform:T,webKitTransform:T,height:y,width:d},R=t?h:u,S=t?n.getPlugin("poster"):null;Object.keys(E).map(function(x){R.style[x]=E[x],S&&S.root&&(S.root.style[x]=E[x])})}},{key:"rotate",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=this.player;this.rotateDeg||(this.rotateDeg=0);var a=e?1:-1;this.rotateDeg=(this.rotateDeg+1+a*.25*n)%1,this.updateRotateDeg(this.rotateDeg,t),r.emit(ji,this.rotateDeg*360)}},{key:"registerIcons",value:function(){return{rotate:Xn}}},{key:"render",value:function(){if(!this.config.disable)return`
    <xg-icon class="xgplayer-rotate">
      <div class="xgplayer-icon">
      </div>
      `.concat(Ve(this,"ROTATE_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"rotate"}},{key:"defaultConfig",get:function(){return{position:W.CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}}]),s}(ut);function Jn(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="10 0 24 40">
  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>
</svg>
`,"image/svg+xml").firstChild}var Zn=function(l){F(s,l);var o=M(s);function s(i){var e;return L(this,s),e=o.call(this,i),k(C(e),"playNext",function(t){var n=C(e),r=n.player;t.preventDefault(),t.stopPropagation(),e.idx+1<e.config.urlList.length?(e.idx++,e.nextHandler(e.config.urlList[e.idx],e.idx),r.emit(nt,e.idx+1)):(e.nextHandler(),r.emit(nt))}),e.idx=-1,e}return A(s,[{key:"afterCreate",value:function(){!this.config.urlList||this.config.urlList.length===0||(this.appendChild(".xgplayer-icon",this.icons.playNext),this.initEvents())}},{key:"registerIcons",value:function(){return{playNext:Jn}}},{key:"initEvents",value:function(){this.nextHandler=this.hook("nextClick",this.changeSrc);var e=w.device==="mobile"?"touchend":"click";this.bind(e,this.playNext),this.show()}},{key:"changeSrc",value:function(e){var t=this.player;e&&(t.pause(),t.currentTime=0,t.switchURL?t.switchURL(e):t.src=e,t.config.url=e,t.play())}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.playNext)}},{key:"render",value:function(){if(!(!this.config.urlList||this.config.urlList.length===0))return`
     <xg-icon class="xgplayer-playnext">
      <div class="xgplayer-icon">
      </div>
      `.concat(Ve(this,"PLAYNEXT_TIPS",this.playerConfig.isHideTips),`
     </xg-icon>
    `)}}],[{key:"pluginName",get:function(){return"playNext"}},{key:"defaultConfig",get:function(){return{position:W.CONTROLS_LEFT,index:1,url:null,urlList:[]}}}]),s}(J),ni={exports:{}};(function(l,o){(function(s,i){l.exports=i()})(_i,function(){return function s(i,e,t){var n=window,r="application/octet-stream",a=t||r,u=i,c=!e&&!t&&u,h=document.createElement("a"),g=function(b){return String(b)},v=n.Blob||n.MozBlob||n.WebKitBlob||g,d=e||"download",y,m;if(v=v.call?v.bind(n):Blob,String(this)==="true"&&(u=[u,a],a=u[0],u=u[1]),c&&c.length<2048&&(d=c.split("/").pop().split("?")[0],h.href=c,h.href.indexOf(c)!==-1)){var _=new XMLHttpRequest;return _.open("GET",c,!0),_.responseType="blob",_.onload=function(b){s(b.target.response,d,r)},setTimeout(function(){_.send()},0),_}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(u))if(u.length>1024*1024*1.999&&v!==g)u=S(u),a=u.type||r;else return navigator.msSaveBlob?navigator.msSaveBlob(S(u),d):x(u);else if(/([\x80-\xff])/.test(u)){var T=0,E=new Uint8Array(u.length),R=E.length;for(T;T<R;++T)E[T]=u.charCodeAt(T);u=new v([E],{type:a})}y=u instanceof v?u:new v([u],{type:a});function S(b){var B=b.split(/[:;,]/),U=B[1],Z=B[2]=="base64"?atob:decodeURIComponent,ue=Z(B.pop()),q=ue.length,j=0,ee=new Uint8Array(q);for(j;j<q;++j)ee[j]=ue.charCodeAt(j);return new v([ee],{type:U})}function x(b,B){if("download"in h)return h.href=b,h.setAttribute("download",d),h.className="download-js-link",h.innerHTML="downloading...",h.style.display="none",document.body.appendChild(h),setTimeout(function(){h.click(),document.body.removeChild(h),B===!0&&setTimeout(function(){n.URL.revokeObjectURL(h.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(b)&&(b="data:"+b.replace(/^data:([\w\/\-\+]+)/,r)),window.open(b)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=b),!0;var U=document.createElement("iframe");document.body.appendChild(U),!B&&/^data:/.test(b)&&(b="data:"+b.replace(/^data:([\w\/\-\+]+)/,r)),U.src=b,setTimeout(function(){document.body.removeChild(U)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(y,d);if(n.URL)x(n.URL.createObjectURL(y),!0);else{if(typeof y=="string"||y.constructor===g)try{return x("data:"+a+";base64,"+n.btoa(y))}catch(b){return x("data:"+a+","+encodeURIComponent(y))}m=new FileReader,m.onload=function(b){x(this.result)},m.readAsDataURL(y)}return!0}})})(ni);var Qn=ni.exports;const er=Wt(Qn);function tr(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">
  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">
      <g id="Group-2">
        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">
          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>
          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>
          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>
          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>
        </g>
      </g>
    </g>
  </g>
</svg>
`,"image/svg+xml").firstChild}var ir=function(l){F(s,l);var o=M(s);function s(i){var e;return L(this,s),e=o.call(this,i),k(C(e),"download",function(t){if(!e.isLock){e.emitUserAction(t,"download");var n=e.playerConfig.url,r="";f.typeOf(n)==="String"?r=n:f.typeOf(n)==="Array"&&n.length>0&&(r=n[0].src);var a=e.getAbsoluteURL(r);er(a),e.isLock=!0,e.timer=window.setTimeout(function(){e.isLock=!1,window.clearTimeout(e.timer),e.timer=null},300)}}),e.timer=null,e.isLock=!1,e}return A(s,[{key:"afterCreate",value:function(){P(I(s.prototype),"afterCreate",this).call(this),!this.config.disable&&(this.appendChild(".xgplayer-icon",this.icons.download),this._handler=this.hook("click",this.download,{pre:function(t){t.preventDefault(),t.stopPropagation()}}),this.bind(["click","touchend"],this._handler))}},{key:"registerIcons",value:function(){return{download:tr}}},{key:"getAbsoluteURL",value:function(e){if(!e.match(/^https?:\/\//)){var t=document.createElement("div");t.innerHTML='<a href="'.concat(e,'">x</a>'),e=t.firstChild.href}return e}},{key:"destroy",value:function(){P(I(s.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.download),window.clearTimeout(this.timer),this.timer=null}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-download">
   <div class="xgplayer-icon">
   </div>
   `.concat(Ve(this,"DOWNLOAD_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"download"}},{key:"defaultConfig",get:function(){return{position:W.CONTROLS_RIGHT,index:3,disable:!0}}}]),s}(ut),nr=function(l){F(s,l);var o=M(s);function s(){return L(this,s),o.apply(this,arguments)}return A(s,[{key:"beforeCreate",value:function(e){typeof e.player.config.screenShot=="boolean"&&(e.config.disable=!e.player.config.screenShot)}},{key:"afterCreate",value:function(){P(I(s.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.screenshotIcon);var e=this.config;this.initSize=function(t){e.fitVideo&&(e.width=t.vWidth,e.height=t.vHeight)},this.once(be,this.initSize)}},{key:"onPluginsReady",value:function(){this.show(),this.onClickBtn=this.onClickBtn.bind(this),this.bind(["click","touchend"],this.onClickBtn)}},{key:"saveScreenShot",value:function(e,t){var n=document.createElement("a");n.href=e,n.download=t;var r;try{typeof MouseEvent!="undefined"?r=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}):(r=document.createEvent("MouseEvents"),r.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null))}catch(a){console.error("MouseEvent unsupported",a)}r&&n.dispatchEvent(r)}},{key:"createCanvas",value:function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");this.canvasCtx=r,this.canvas=n,n.width=e||this.config.width,n.height=t||this.config.height,r.imageSmoothingEnabled=!0,r.imageSmoothingEnabled&&(r.imageSmoothingQuality="high")}},{key:"onClickBtn",value:function(e){var t=this;e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"shot");var n=this.config;this.shot(n.width,n.height).then(function(r){t.emit(zi,r),n.saveImg&&t.saveScreenShot(r,n.name+n.format)})}},{key:"shot",value:function(e,t){var n=this,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{quality:.92,type:"image/png"},a=this.config,u=this.player,c=r.quality||a.quality,h=r.type||a.type;return new Promise(function(g,v){var d=null,y;if(u.media.canvas)d=u.media.canvas;else{n.canvas?(n.canvas.width=e||a.width,n.canvas.height=t||a.height):n.createCanvas(e,t),d=n.canvas,y=n.canvasCtx;var m=u.media.videoWidth/u.media.videoHeight,_=d.width/d.height,T=0,E=0,R=u.media.videoWidth,S=u.media.videoHeight,x,b,B,U;m>_?(B=d.width,U=d.width/m,x=0,b=Math.round((d.height-U)/2)):m===_?(B=d.width,U=d.height,x=0,b=0):m<_&&(B=d.height*m,U=d.height,x=Math.round((d.width-B)/2),b=0),y.drawImage(u.media,T,E,R,S,x,b,B,U)}var Z=d.toDataURL(h,c).replace(h,"image/octet-stream");Z=Z.replace(/^data:image\/[^;]+/,"data:application/octet-stream"),g(Z)})}},{key:"registerIcons",value:function(){return{screenshotIcon:null}}},{key:"destroy",value:function(){P(I(s.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.onClickBtn),this.off(be,this.initSize)}},{key:"render",value:function(){if(!this.config.disable){var e=this.icons.screenshotIcon?"xgplayer-icon":"xgplayer-icon btn-text",t="SCREENSHOT";return`
      <xg-icon class="xgplayer-shot">
      <div class="`.concat(e,`">
      `).concat(this.icons.screenshotIcon?"":'<span lang-key="'.concat(this.i18nKeys[t],'">').concat(this.i18n[t],"</span>"),`
      </div>
    </xg-icon>`)}}}],[{key:"pluginName",get:function(){return"screenShot"}},{key:"defaultConfig",get:function(){return{position:W.CONTROLS_RIGHT,index:5,quality:.92,type:"image/png",format:".png",width:600,height:337,saveImg:!0,fitVideo:!0,disable:!1,name:"screenshot"}}}]),s}(ut),rr=function(){function l(o){L(this,l),this.config=o.config,this.parent=o.root,this.root=f.createDom("ul","",{},"xg-options-list xg-list-slide-scroll ".concat(this.config.className)),o.root.appendChild(this.root);var s=this.config.maxHeight;s&&this.setStyle({maxHeight:s}),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();var i=this.config.domEventType==="touch"?"touchend":"click";this._delegates=J.delegate.call(this,this.root,"li",i,this.onItemClick)}return A(l,[{key:"renderItemList",value:function(s){var i=this,e=this.config,t=this.root;s?e.data=s:s=e.data,e.style&&Object.keys(e.style).map(function(n){t.style[n]=e[n]}),s.length>0&&(this.attrKeys=Object.keys(s[0])),this.root.innerHTML="",s.map(function(n,r){var a=n.selected?"option-item selected":"option-item";n["data-index"]=r,i.root.appendChild(f.createDom("li","<span>".concat(n.showText,"</span>"),n,a))})}},{key:"onItemClick",value:function(s){s.delegateTarget||(s.delegateTarget=s.target);var i=s.delegateTarget;if(i&&f.hasClass(i,"selected"))return!1;var e=typeof this.config.onItemClick=="function"?this.config.onItemClick:null,t=this.root.querySelector(".selected");f.addClass(i,"selected"),t&&f.removeClass(t,"selected"),e(s,{from:t?this.getAttrObj(t,this.attrKeys):null,to:this.getAttrObj(i,this.attrKeys)})}},{key:"getAttrObj",value:function(s,i){if(!s||!i)return{};var e={};i.map(function(n){e[n]=s.getAttribute(n)});var t=s.getAttribute("data-index");return t&&(e.index=Number(t)),e}},{key:"show",value:function(){f.removeClass(this.root,"hide"),f.addClass(this.root,"active")}},{key:"hide",value:function(){f.removeClass(this.root,"active"),f.addClass(this.root,"hide")}},{key:"setStyle",value:function(s){var i=this;Object.keys(s).forEach(function(e){i.root.style[e]=s[e]})}},{key:"destroy",value:function(){this._delegates&&(this._delegates.map(function(s){s.destroy&&s.destroy()}),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}]),l}(),re={SIDE:"side",MIDDLE:"middle",DEFAULT:"default"},me={CLICK:"click",HOVER:"hover"};function sr(l,o){return l===re.SIDE?o===W.CONTROLS_LEFT?"xg-side-list xg-left-side":"xg-side-list xg-right-side":""}var ge=w.device==="mobile",ze=function(l){F(s,l);var o=M(s);function s(i){var e;return L(this,s),e=o.call(this,i),k(C(e),"onEnter",function(t){t.stopPropagation(),e.emit("icon_mouseenter",{pluginName:e.pluginName}),e.switchActiveState(t)}),k(C(e),"switchActiveState",function(t){t.stopPropagation();var n=e.config.toggleMode;n===me.CLICK?e.toggle(!e.isActive):e.toggle(!0)}),k(C(e),"onLeave",function(t){t.stopPropagation(),e.emit("icon_mouseleave",{pluginName:e.pluginName}),e.config.listType!==re.SIDE&&e.isActive&&e.toggle(!1)}),k(C(e),"onListEnter",function(t){e.enterType=2}),k(C(e),"onListLeave",function(t){e.enterType=0,e.isActive&&e.toggle(!1)}),e.isIcons=!1,e.isActive=!1,e.curValue=null,e.curIndex=0,e}return A(s,[{key:"updateLang",value:function(e){this.renderItemList(this.config.list,this.curIndex)}},{key:"afterCreate",value:function(){var e=this,t=this.config;this.initIcons(),ge=ge||this.domEventType==="touch",ge&&w.device==="mobile"&&t.listType===re.DEFAULT&&(t.listType=re.SIDE),t.hidePortrait&&f.addClass(this.root,"portrait"),this.on([be,ve],function(){e._resizeList()}),this.once(Ee,function(){t.list&&t.list.length>0&&(e.renderItemList(t.list),e.show())}),ge&&this.on($t,function(){e.isActive&&(e.optionsList&&e.optionsList.hide(),e.isActive=!1)}),ge?(t.toggleMode=me.CLICK,this.activeEvent="touchend"):this.activeEvent=t.toggleMode===me.CLICK?"click":"mouseenter",t.toggleMode===me.CLICK?this.bind(this.activeEvent,this.switchActiveState):(this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)),this.isIcons&&this.bind("click",this.onIconClick)}},{key:"initIcons",value:function(){var e=this,t=this.icons,n=Object.keys(t),r=!1;n.length>0&&(n.forEach(function(a){e.appendChild(".xgplayer-icon",t[a]),!r&&(r=t[a])}),this.isIcons=r),!r&&(this.appendChild(".xgplayer-icon",f.createDom("span","",{},"icon-text")),f.addClass(this.find(".xgplayer-icon"),"btn-text"))}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||f.addClass(this.root,"show")}},{key:"hide",value:function(){f.removeClass(this.root,"show")}},{key:"getTextByLang",value:function(e,t,n){if(e===void 0)return"";var r=this.config.list;!n&&(n=this.player.lang),t=!t||f.isUndefined(e[t])?"text":t,typeof e=="number"&&(e=r[e]);try{return Yt(e[t])==="object"?e[t][n]||e[t].en:e[t]}catch(a){return console.warn(a),""}}},{key:"toggle",value:function(e){if(!(e===this.isActive||this.config.disable)){var t=this.player.controls,n=this.config.listType;e?(n===re.SIDE?t.blur():t.focus(),this.optionsList&&this.optionsList.show()):(n===re.SIDE?t.focus():t.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=e}}},{key:"onItemClick",value:function(e,t){e.stopPropagation();var n=this.config,r=n.listType,a=n.list;this.curIndex=t.to.index,this.curItem=a[this.curIndex],this.changeCurrentText();var u=this.config.isItemClickHide;(u||ge||r===re.SIDE)&&this.toggle(!1)}},{key:"onIconClick",value:function(e){}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,t=this.curIndex<e.length?this.curIndex:0,n=e[t];n&&(this.find(".icon-text").innerHTML=this.getTextByLang(n,"iconText"))}}},{key:"renderItemList",value:function(e,t){var n=this,r=this.config,a=this.optionsList,u=this.player;if(typeof t=="number"&&(this.curIndex=t,this.curItem=r.list[t]),a){a.renderItemList(e),this.changeCurrentText();return}var c={config:{data:e||[],className:sr(r.listType,r.position),onItemClick:function(y,m){n.onItemClick(y,m)},domEventType:ge?"touch":"mouse"},root:r.listType===re.SIDE?u.innerContainer||u.root:this.root};if(this.config.isShowIcon){var h=this.player.root.getBoundingClientRect(),g=h.height,v=r.listType===re.MIDDLE?g-50:g;v&&r.heightLimit&&(c.config.maxHeight="".concat(v,"px")),this.optionsList=new rr(c),this.changeCurrentText(),this.show()}this._resizeList()}},{key:"_resizeList",value:function(){if(this.config.heightLimit){var e=this.player.root.getBoundingClientRect(),t=e.height,n=this.config.listType===re.MIDDLE?t-50:t;this.optionsList&&this.optionsList.setStyle({maxHeight:"".concat(n,"px")})}}},{key:"destroy",value:function(){var e=this.config;e.toggleMode===me.CLICK?this.unbind(this.activeEvent,this.switchActiveState):(this.unbind(this.activeEvent,this.onEnter),this.unbind("mouseleave",this.onLeave)),this.isIcons&&this.unbind("click",this.onIconClick),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}},{key:"render",value:function(){if(this.config.isShowIcon)return'<xg-icon class="xg-options-icon '.concat(this.config.className||"",`">
    <div class="xgplayer-icon">
    </div>
   </xg-icon>`)}}],[{key:"pluginName",get:function(){return"optionsIcon"}},{key:"defaultConfig",get:function(){return{position:W.CONTROLS_RIGHT,index:100,list:[],listType:"default",listStyle:{},hidePortrait:!0,isShowIcon:!1,isItemClickHide:!0,toggleMode:me.HOVER,heightLimit:!0}}}]),s}(J),ar=function(l){F(s,l);var o=M(s);function s(i){var e;return L(this,s),e=o.call(this,i),e.curTime=0,e.isPaused=!0,e}return A(s,[{key:"beforeCreate",value:function(e){var t=e.config.list;Array.isArray(t)&&t.length>0&&(e.config.list=t.map(function(n){return!n.text&&n.name&&(n.text=n.name),n.text||(n.text=n.definition),n}))}},{key:"afterCreate",value:function(){var e=this;P(I(s.prototype),"afterCreate",this).call(this),this.on("resourceReady",function(t){e.changeDefinitionList(t)}),this.on(Vt,function(t){e.renderItemList(e.config.list,t.to)}),this.player.definitionList.length<2&&this.hide()}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||f.addClass(this.root,"show")}},{key:"initDefinition",value:function(){var e=this.config,t=e.list,n=e.defaultDefinition;if(t.length>0){var r=null;t.map(function(a){a.definition===n&&(r=a)}),r||(r=t[0]),this.changeDefinition(r)}}},{key:"renderItemList",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.list||[],n=arguments.length>1?arguments[1]:void 0,r=n&&n.definition?n.definition:this.config.defaultDefinition;n&&t.forEach(function(c){c.selected=!1});var a=0,u=t.map(function(c,h){var g=se(se({},c),{},{showText:e.getTextByLang(c)||c.definition,selected:!1});return(c.selected||c.definition&&c.definition==r)&&(g.selected=!0,a=h),g});P(I(s.prototype),"renderItemList",this).call(this,u,a)}},{key:"changeDefinitionList",value:function(e){Array.isArray(e)&&(this.config.list=e.map(function(t){return!t.text&&t.name&&(t.text=t.name),t.text||(t.text=t.definition),t}),this.renderItemList(),this.config.list.length<2?this.hide():this.show())}},{key:"changeDefinition",value:function(e,t){this.player.changeDefinition(e,t)}},{key:"onItemClick",value:function(e,t){var n=this.player.definitionList;P(I(s.prototype),"onItemClick",this).apply(this,arguments),this.emitUserAction(e,"change_definition",{from:t.from,to:t.to});for(var r=0;r<n.length;r++)t.to&&n[r].definition===t.to.definition&&(t.to.url=n[r].url),t.from&&n[r].definition===t.from.definition&&(t.from.url=n[r].url);this.player.changeDefinition(t.to,t.from)}}],[{key:"pluginName",get:function(){return"definition"}},{key:"defaultConfig",get:function(){return se(se({},ze.defaultConfig),{},{position:W.CONTROLS_RIGHT,index:3,list:[],defaultDefinition:"",disable:!1,hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0})}}]),s}(ze),or=function(l){F(s,l);var o=M(s);function s(i){var e;return L(this,s),e=o.call(this,i),e.curRate=1,e}return A(s,[{key:"beforeCreate",value:function(e){var t=e.player.config.playbackRate,n=t?Array.isArray(t)?t:e.config.list:[];Array.isArray(n)&&(e.config.list=n.map(function(r){return typeof r=="number"?r={rate:r,text:"".concat(r,"x")}:!r.text&&r.rate&&(r.text="".concat(r.rate,"x")),r}))}},{key:"afterCreate",value:function(){var e=this;P(I(s.prototype),"afterCreate",this).call(this),this.on(Vi,function(){e.curValue!==e.player.playbackRate&&e.renderItemList()}),this.renderItemList()}},{key:"show",value:function(e){!this.config.list||this.config.list.length===0||P(I(s.prototype),"show",this).call(this)}},{key:"onItemClick",value:function(e,t){P(I(s.prototype),"onItemClick",this).call(this,e,t);var n=e.delegateTarget,r=Number(n.getAttribute("rate"));if(!r||r===this.curValue)return!1;var a={playbackRate:{from:this.player.playbackRate,to:r}};this.emitUserAction(e,"change_rate",{props:a}),this.curValue=r,this.player.playbackRate=r}},{key:"renderItemList",value:function(){var e=this,t=this.player.playbackRate||1;this.curValue=t;var n=-1,r=this.config.list.map(function(a,u){var c={rate:a.rate};return c.rate===t&&(c.selected=!0,n=u),c.showText=e.getTextByLang(a),c});P(I(s.prototype),"renderItemList",this).call(this,r,n)}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,t=this.curIndex<e.length?this.curIndex:0,n=e[t],r="";!n||this.curIndex<0?r="".concat(this.player.playbackRate,"x"):r=this.getTextByLang(n,"iconText"),this.find(".icon-text").innerHTML=r}}},{key:"destroy",value:function(){P(I(s.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"playbackRate"}},{key:"defaultConfig",get:function(){return se(se({},ze.defaultConfig),{},{position:W.CONTROLS_RIGHT,index:4,list:[2,1.5,1,.75,.5],className:"xgplayer-playbackrate",isShowIcon:!0,hidePortrait:!1})}}]),s}(ze),Ht={time:0,text:"",id:1,duration:1,color:"#fff",style:{},width:6,height:6};function ri(l){Object.keys(Ht).map(function(o){l[o]===void 0&&(l[o]=Ht[o])})}var Ut={_updateDotDom:function(o,s){if(s){var i=this.calcuPosition(o.time,o.duration),e=o.style||{};e.left="".concat(i.left,"%"),e.width="".concat(i.width,"%"),s.setAttribute("data-text",o.text),s.setAttribute("data-time",o.time),i.isMini?f.addClass(s,"mini"):f.removeClass(s,"mini"),Object.keys(e).map(function(t){s.style[t]=e[t]})}},initDots:function(){var o=this;this._ispots.map(function(s){o.createDot(s,!1)}),this.ispotsInit=!0},createDot:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=this.player.plugins.progress;if(i&&(s&&(ri(o),this._ispots.push(o)),!(!this.ispotsInit&&s))){var e=this.calcuPosition(o.time,o.duration),t=o.style||{};t.left="".concat(e.left,"%"),t.width="".concat(e.width,"%");var n="xgspot_".concat(o.id," xgplayer-spot");e.isMini&&(n+=" mini");var r=o.template?'<div class="xgplayer-spot-pop">'.concat(o.template,"</div>"):"",a=f.createDom("xg-spot",r,{"data-text":o.text,"data-time":o.time,"data-id":o.id},n);Object.keys(t).map(function(u){a.style[u]=t[u]}),i.outer&&i.outer.appendChild(a),this.positionDot(a,o.id)}},findDot:function(o){if(this.player.plugins.progress){var s=this._ispots.filter(function(i,e){return i.id===o});return s.length>0?s[0]:null}},updateDot:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=this.player.plugins.progress;if(i){var e=this.findDot(o.id);if(e&&Object.keys(o).map(function(n){e[n]=o[n]}),!!this.ispotsInit){var t=i.find('xg-spot[data-id="'.concat(o.id,'"]'));t&&(this._updateDotDom(o,t),s&&this.showDot(o.id))}}},deleteDot:function(o){var s=this._ispots,i=this.player.plugins.progress;if(i){for(var e=[],t=0;t<s.length;t++)s[t].id===o&&e.push(t);for(var n=e.length,r=n-1;r>=0;r--)if(s.splice(e[r],1),this.ispotsInit){var a=i.find('xg-spot[data-id="'.concat(o,'"]'));a&&a.parentElement.removeChild(a)}}},deleteAllDots:function(){var o=this.player.plugins.progress;if(o){if(!this.ispotsInit){this._ispots=[];return}for(var s=o.root.getElementsByTagName("xg-spot"),i=s.length-1;i>=0;i--)o.outer.removeChild(s[i]);this._ispots=[]}},updateAllDots:function(){var o=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],i=this.player.plugins.progress;if(i){if(!this.ispotsInit){this._ispots=s;return}this._ispots=[];var e=i.root.getElementsByTagName("xg-spot"),t=e.length;if(t>s.length)for(var n=t-1;n>s.length-1;n--)i.outer.removeChild(e[n]);s.forEach(function(r,a){a<t?(e[a].setAttribute("data-id","".concat(r.id)),o._ispots.push(r),o.updateDot(r)):o.createDot(r)})}},positionDots:function(){var o=this,s=this._ispots,i=this.playerSize,e=this.player.sizeInfo,t=this.player.plugins.progress;!t||e.width===i.width||(i.width=e.width,i.left=e.left,s.forEach(function(n){var r=t.find('xg-spot[data-id="'.concat(n.id,'"]'));r&&o.positionDot(r,n.id)}))},positionDot:function(o,s){var i=f.findDom(o,".xgplayer-spot-pop");if(i){var e=this.playerSize,t=o.getBoundingClientRect(),n=i.getBoundingClientRect(),r=t.left-e.left,a=e.width-r-t.width/2;if(r<n.width/2||e.width<n.width){var u=n.width/2-r;i.style.left="".concat(u,"px")}else if(a<n.width/2){var c=a-n.width/2+t.width/2;i.style.left="".concat(c,"px")}else i.style.left="50%"}},updateDuration:function(){var o=this,s=this.player.plugins.progress;if(s){var i=this._ispots;i.forEach(function(e){var t=s.find('xg-spot[data-id="'.concat(e.id,'"]'));o._updateDotDom(e,t)})}},getAllDotsDom:function(){var o=this.player.plugins.progress;if(!o)return[];var s=o.root.getElementsByTagName("xg-spot");return s},getDotDom:function(o){var s=this.player.plugins.progress;if(s)return s.find('xg-spot[data-id="'.concat(o,'"]'))}};function ur(l){var o=l.config,s=l.player;Object.keys(Ut).map(function(e){l[e]=Ut[e].bind(l)});var i=s.config.progressDot||o.ispots||[];l._ispots=i.map(function(e){return ri(e),e}),l.ispotsInit=!1,l.playerSize={left:s.sizeInfo.left,width:s.sizeInfo.width},l.on(ot,function(){l.ispotsInit?l.updateDuration():l.initDots()}),l.on(be,function(){l.positionDots()})}var ye={dragmove:"onProgressMove",dragstart:"onProgressDragStart",dragend:"onProgressDragEnd",click:"onProgressClick",mouseover:"onProgressMouseOver",mouseenter:"onProgressMouseOver"},lr=function(l){F(s,l);var o=M(s);function s(i){var e;return L(this,s),e=o.call(this,i),k(C(e),"onMousemove",function(t){if(!e.config.disable){if(f.hasClass(t.target,"xg-spot-content")&&e.config.isHideThumbnailHover){e.player.plugins.progress.onMouseLeave(t);return}(e._state.f||f.hasClass(t.target,"xg-spot-content"))&&(f.event(t),t.stopPropagation())}}),k(C(e),"onMousedown",function(t){e.config.disable||(e._state.f||f.hasClass(t.target,"xg-spot-content"))&&(f.event(t),t.stopPropagation())}),k(C(e),"onMouseup",function(t){if(e.isDrag){var n=e.player.plugins.progress;n&&n.pos&&(n.onMouseUp(t),!n.pos.isEnter&&n.onMouseLeave(t))}}),k(C(e),"onDotMouseLeave",function(t){if(!e.config.disable){e._curDot.removeEventListener("mouseleave",e.onDotMouseLeave),e.blurDot(t.target),e._curDot=null;var n=e.player.plugins.progress;n&&n.enableBlur(),e.show()}}),k(C(e),"onProgressMouseOver",function(t,n){if(!e.config.disable&&f.hasClass(n.target,"xgplayer-spot")&&!e._curDot){e._curDot=n.target,e.focusDot(n.target),e._curDot.children.length>0&&e.hide();var r=e.player.plugins.progress;r&&r.disableBlur(),e._curDot.addEventListener("mouseleave",e.onDotMouseLeave)}}),e._ispots=[],e.videoPreview=null,e.videothumbnail=null,e.thumbnail=null,e.timeStr="",e._state={now:0,f:!1},e}return A(s,[{key:"beforeCreate",value:function(e){var t=e.player.plugins.progress;t&&(e.root=t.root)}},{key:"afterCreate",value:function(){var e=this;this._curDot=null,this.handlerSpotClick=this.hook("spotClick",function(t,n){n.seekTime&&e.player.seek(n.seekTime)}),this.transformTimeHook=this.hook("transformTime",function(t){e.setTimeContent(f.format(t))}),ur(this),this.on(ot,function(){e.show()}),this.config.disable&&this.disable(),this.extTextRoot=this.find(".xg-spot-ext-text")}},{key:"setConfig",value:function(e){var t=this;e&&Object.keys(e).map(function(n){t.config[n]=e[n]})}},{key:"onPluginsReady",value:function(){var e=this.player;e.plugins.progress&&(this.previewLine=this.find(".xg-spot-line"),this.timePoint=this.find(".xgplayer-progress-point"),this.timeText=this.find(".xg-spot-time"),this.tipText=this.find(".spot-inner-text"),this._hasThumnail=!1,this.registerThumbnail(),this.bindEvents())}},{key:"bindEvents",value:function(){var e=this,t=this.player.plugins.progress;if(t&&(Object.keys(ye).map(function(r){e[ye[r]]=e[ye[r]].bind(e),t.addCallBack(r,e[ye[r]])}),w.device!=="mobile")){this.bind(".xg-spot-info","mousemove",this.onMousemove),this.bind(".xg-spot-info","mousedown",this.onMousedown),this.bind(".xg-spot-info","mouseup",this.onMouseup);var n=this.hook("previewClick",function(){});this.handlerPreviewClick=function(r){r.stopPropagation(),n(parseInt(e._state.now*1e3,10)/1e3,r)},this.bind(".xg-spot-content","mouseup",this.handlerPreviewClick)}}},{key:"onProgressMove",value:function(e,t){this.config.disable||!this.player.duration||this.updatePosition(e.offset,e.width,e.currentTime,e.e)}},{key:"onProgressDragStart",value:function(e){this.config.disable||!this.player.duration||(this.isDrag=!0,this.videoPreview&&f.addClass(this.videoPreview,"show"))}},{key:"onProgressDragEnd",value:function(e){this.config.disable||!this.player.duration||(this.isDrag=!1,this.videoPreview&&f.removeClass(this.videoPreview,"show"))}},{key:"onProgressClick",value:function(e,t){this.config.disable||f.hasClass(t.target,"xgplayer-spot")&&(t.stopPropagation(),t.preventDefault(),["time","id","text"].map(function(n){e[n]=t.target.getAttribute("data-".concat(n))}),e.time&&(e.time=Number(e.time)),this.handlerSpotClick(t,e))}},{key:"updateLinePos",value:function(e,t){var n=this.root,r=this.previewLine,a=this.player,u=this.config,c=a.controls.mode,h=c==="flex",g=n.getBoundingClientRect().width;if(!(!g&&this._hasThumnail)){g=this._hasThumnail&&g<u.width?u.width:g;var v=e-g/2,d;v<0&&!h?(v=0,d=e-g/2):v>t-g&&!h?(d=v-(t-g),v=t-g):d=0,d!==void 0&&(r.style.transform="translateX(".concat(d.toFixed(2),"px)")),n.style.transform="translateX(".concat(v.toFixed(2),"px) translateZ(0)")}}},{key:"updateTimeText",value:function(e){var t=this.timeText,n=this.timePoint;t.innerHTML=e,!this.thumbnail&&(n.innerHTML=e)}},{key:"updatePosition",value:function(e,t,n,r){var a=this.root,u=this.config,c=this._state;if(a){c.now=n,this.transformTimeHook(n);var h=this.timeStr;r&&r.target&&f.hasClass(r.target,"xgplayer-spot")?(this.showTips(r.target.getAttribute("data-text"),!1,h),this.focusDot(r.target),c.f=!0,u.isFocusDots&&c.f&&(c.now=parseInt(r.target.getAttribute("data-time"),10))):u.defaultText?(c.f=!1,this.showTips(u.defaultText,!0,h)):(c.f=!1,this.hideTips("")),this.updateTimeText(h),this.updateThumbnails(c.now),this.updateLinePos(e,t)}}},{key:"setTimeContent",value:function(e){this.timeStr=e}},{key:"updateThumbnails",value:function(e){var t=this.player,n=this.videoPreview,r=this.config,a=t.plugins.thumbnail;if(a&&a.usable){this.thumbnail&&a.update(this.thumbnail,e,r.width,r.height);var u=n&&n.getBoundingClientRect();this.videothumbnail&&a.update(this.videothumbnail,e,u.width,u.height)}}},{key:"registerThumbnail",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(w.device!=="mobile"){var t=this.player,n=this.config,r=t.getPlugin("thumbnail");if(r&&r.setConfig(e),!r||!r.usable||!n.isShowThumbnail){f.addClass(this.root,"short-line no-thumbnail");return}else f.removeClass(this.root,"short-line no-thumbnail");n.mode==="short"&&f.addClass(this.root,"short-line"),this._hasThumnail=!0;var a=this.find(".xg-spot-thumbnail");this.thumbnail=r.createThumbnail(a,"progress-thumbnail"),n.isShowCoverPreview&&(this.videoPreview=f.createDom("xg-video-preview","",{},"xgvideo-preview"),t.root.appendChild(this.videoPreview),this.videothumbnail=r.createThumbnail(this.videoPreview,"xgvideo-thumbnail")),this.updateThumbnails(0)}}},{key:"calcuPosition",value:function(e,t){var n=this.player.plugins.progress,r=this.player,a=n.root.getBoundingClientRect().width,u=r.duration/a*6;return e+t>r.duration&&(t=r.duration-e),e/r.duration*100,t/r.duration,{left:e/r.duration*100,width:t/r.duration*100,isMini:t<u}}},{key:"showDot",value:function(e){var t=this.findDot(e);if(t){var n=this.root.getBoundingClientRect(),r=n.width,a=t.time/this.player.duration*r;this.updatePosition(a,r,t.time)}}},{key:"focusDot",value:function(e,t){e&&(t||(t=e.getAttribute("data-id")),f.addClass(e,"active"),this._activeDotId=t)}},{key:"blurDot",value:function(e){if(!e){var t=this._activeDotId;e=this.getDotDom(t)}e&&(f.removeClass(e,"active"),this._activeDotId=null)}},{key:"showTips",value:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";f.addClass(this.root,"no-timepoint"),e&&(f.addClass(this.find(".xg-spot-content"),"show-text"),t&&this.config.mode==="production"?(f.addClass(this.root,"product"),this.tipText.textContent=e):(f.removeClass(this.root,"product"),this.tipText.textContent=this._hasThumnail?e:"".concat(n," ").concat(e)))}},{key:"hideTips",value:function(){f.removeClass(this.root,"no-timepoint"),this.tipText.textContent="",f.removeClass(this.find(".xg-spot-content"),"show-text"),f.removeClass(this.root,"product")}},{key:"hide",value:function(){f.addClass(this.root,"hide")}},{key:"show",value:function(e){f.removeClass(this.root,"hide")}},{key:"enable",value:function(){var e=this.config,t=this.playerConfig;this.config.disable=!1,this.show(),!this.thumbnail&&e.isShowThumbnail&&this.registerThumbnail(t.thumbnail||{})}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){var e=this,t=this.player.plugins.progress;t&&Object.keys(ye).map(function(n){t.removeCallBack(n,e[ye[n]])}),this.videothumbnail=null,this.thumbnail=null,this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.unbind(".xg-spot-info","mousemove",this.onMousemove),this.unbind(".xg-spot-info","mousedown",this.onMousedown),this.unbind(".xg-spot-info","mouseup",this.onMouseup),this.unbind(".xg-spot-content","mouseup",this.handlerPreviewClick)}},{key:"render",value:function(){return w.device==="mobile"||this.playerConfig.isMobileSimulateMode==="mobile"?"":'<div class="xg-spot-info hide '.concat(this.config.mode==="short"?"short-line":"",`">
      <div class="xg-spot-content">
        <div class="xg-spot-thumbnail">
          <span class="xg-spot-time"></span>
        </div>
        <div class="xg-spot-text"><span class="spot-inner-text"></span></div>
      </div>
      <div class="xgplayer-progress-point">00:00</div>
      <div class="xg-spot-ext-text"></div>
      <div class="xg-spot-line"></div>
    </div>`)}}],[{key:"pluginName",get:function(){return"progresspreview"}},{key:"defaultConfig",get:function(){return{index:1,miniWidth:6,ispots:[],defaultText:"",isFocusDots:!0,isHideThumbnailHover:!0,isShowThumbnail:!0,isShowCoverPreview:!1,mode:"",disable:!1,width:160,height:90}}}]),s}(J),_e={REAL_TIME:"realtime",FIRST_FRAME:"firstframe",FRAME_RATE:"framerate",POSTER:"poster"};function cr(){try{return parseInt(window.performance.now(),10)}catch(l){return new Date().getTime()}}function hr(){try{var l=document.createElement("canvas").getContext;return!!l}catch(o){return!1}}var He=null,fr=function(l){F(s,l);var o=M(s);function s(){var i;L(this,s);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i=o.call.apply(o,[this].concat(t)),k(C(i),"onLoadedData",function(r){i.player&&(i._frameCount=i.config.startFrameCount,i.stop(),i.renderOnTimeupdate(r),i.off(Ue,i.renderOnTimeupdate),i.on(Ue,i.renderOnTimeupdate))}),k(C(i),"onVisibilitychange",function(r){document.visibilityState==="visible"?i._checkIfCanStart()&&i.start():document.visibilityState==="hidden"&&i.stop()}),k(C(i),"renderOnTimeupdate",function(r){if(i._frameCount>0)i.renderOnce(),i._frameCount--;else{i._isLoaded=!0,i.off(Ue,i.renderOnTimeupdate);var a=i.config.startInterval;!i.player.paused&&i._checkIfCanStart()&&i.start(0,a)}}),k(C(i),"start",function(r,a){var u=i.player.video,c=cr(),h=i.checkVideoIsSupport(u);!h||!i.canvasCtx||(a||(a=i.interval),i.stop(),u.videoWidth&&u.videoHeight&&(i.videoPI=u.videoHeight>0?parseInt(u.videoWidth/u.videoHeight*100,10):0,(i.config.mode===_e.REAL_TIME||c-i.preTime>=a)&&(u&&u.videoWidth&&i.update(h,i.videoPI),i.preTime=c)),i.frameId=i._loopType==="timer"?f.setTimeout(C(i),i.start,a):f.requestAnimationFrame(i.start))}),k(C(i),"stop",function(){i.frameId&&(i._loopType==="timer"?f.clearTimeout(C(i),i.frameId):f.cancelAnimationFrame(i.frameId),i.frameId=null)}),i}return A(s,[{key:"afterCreate",value:function(){var e=this;this.playerConfig.dynamicBg===!0&&(this.config.disable=!1),s.isSupport||(this.config.disable=!0);var t=this.config,n=t.disable,r=t.mode,a=t.frameRate;n||(this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0,pi:0},this.isStart=!1,this._isLoaded=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/a,10),this.canvas=null,this.canvasCtx=null,this._frameCount=0,this._loopType=this.config.mode!==_e.REAL_TIME&&this.interval>=1e3?"timer":"animation",this.once(zt,function(){e.player&&(e.init(),e.renderByPoster(),e.player.paused||e.start())}),r!==_e.POSTER&&(r!==_e.FIRST_FRAME&&(this.on(Xt,function(){e.stop()}),this.on(fe,function(){var u=e.config.startInterval;e._checkIfCanStart()&&e.start(0,u)}),this.on(at,function(){e.stop()})),this.on(Ge,this.onLoadedData),this.on($i,function(){e._isLoaded=!1,e.stop()}),document.addEventListener("visibilitychange",this.onVisibilitychange)))}},{key:"setConfig",value:function(e){var t=this;Object.keys(e).forEach(function(n){n==="root"&&e[n]!==t.config[n]?t.reRender(e[n]):n==="frameRate"?t.interval=parseInt(1e3/e[n],10):n==="disable"&&e[n]&&t.stop(),t.config[n]=e[n]})}},{key:"init",value:function(e){var t=this.player,n=this.config;this.canvasFilter=s.supportCanvasFilter();try{var r=e||n.root;r||(r=n.isInnerRender&&t.innerContainer||t.root),r.insertAdjacentHTML("afterbegin",'<div class="xgplayer-dynamic-bg" data-index="'.concat(n.index,`"><canvas>
        </canvas><xgmask></xgmask></div>`)),this.root=r.children[0],this.canvas=this.find("canvas"),this.canvasFilter||(this.canvas.style.filter=n.filter,this.canvas.style.webkitFilter=n.filter),this.mask=this.find("xgmask"),n.addMask&&(this.mask.style.background=n.maskBg),this.canvasCtx=this.canvas.getContext("2d")}catch(a){z.logError("plugin:DynamicBg",a)}}},{key:"reRender",value:function(e){var t=this.config.disable;if(!(!t&&!this.root)){this.stop();var n=this.root?this.root.parentElement:null;if(n!==e&&n.removeChild(this.root),!e){this.root=null;return}this.init(e),this.renderOnce();var r=this.config.startInterval;this._checkIfCanStart()&&this.start(0,r)}}},{key:"checkVideoIsSupport",value:function(e){if(!e)return null;var t=e&&e instanceof window.HTMLVideoElement?e:e.canvas?e.canvas:e.flyVideo?e.flyVideo:null;if(t&&!(w.browser==="safari"&&f.isMSE(t)))return t;var n=t?t.tagName.toLowerCase():"";return n==="canvas"||n==="img"?t:null}},{key:"renderByPoster",value:function(){var e=this.playerConfig.poster;if(e){var t=f.typeOf(e)==="String"?e:f.typeOf(e.poster)==="String"?e.poster:null;this.updateImg(t)}}},{key:"_checkIfCanStart",value:function(){var e=this.config.mode;return this._isLoaded&&!this.player.paused&&e!==_e.FIRST_FRAME&&e!==_e.POSTER}},{key:"renderOnce",value:function(){var e=this.player.video;if(!(!e.videoWidth||!e.videoHeight)){this.videoPI=parseInt(e.videoWidth/e.videoHeight*100,10);var t=this.checkVideoIsSupport(e);t&&this.update(t,this.videoPI)}}},{key:"updateImg",value:function(e){var t=this;if(e){var n=this.canvas.getBoundingClientRect(),r=n.width,a=n.height,u=new window.Image;u.onload=function(){if(!(!t.canvas||t.frameId||t.isStart)){t.canvas.height=a,t.canvas.width=r;var c=parseInt(r/a*100,10);t.update(u,c),u=null}},u.src=e}}},{key:"update",value:function(e,t){if(!(!this.canvas||!this.canvasCtx||!t))try{var n=this._pos,r=this.config,a=this.canvas.getBoundingClientRect(),u=a.width,c=a.height;if(u!==n.width||c!==n.height||n.pi!==t){var h=parseInt(u/c*100,10);n.pi=t,n.width!==u&&(n.width=this.canvas.width=u),n.height!==c&&(n.height=this.canvas.height=c);var g=c,v=u;h<t?v=parseInt(c*t/100,10):h>t&&(g=parseInt(u*100/t,10)),n.rwidth=v*r.multiple,n.rheight=g*r.multiple,n.x=(u-n.rwidth)/2,n.y=(c-n.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=r.filter),this.canvasCtx.drawImage(e,n.x,n.y,n.rwidth,n.rheight)}catch(d){z.logError("plugin:DynamicBg",d)}}},{key:"destroy",value:function(){this.stop(),document.removeEventListener("visibilitychange",this.onVisibilitychange),this.canvasCtx=null,this.canvas=null}},{key:"render",value:function(){return""}}],[{key:"pluginName",get:function(){return"dynamicBg"}},{key:"defaultConfig",get:function(){return{isInnerRender:!1,disable:!0,index:-1,mode:"framerate",frameRate:10,filter:"blur(50px)",startFrameCount:2,startInterval:0,addMask:!0,multiple:1.2,maskBg:"rgba(0,0,0,0.7)"}}},{key:"isSupport",get:function(){return typeof He=="boolean"||(He=hr()),He}},{key:"supportCanvasFilter",value:function(){return!(w.browser==="safari"||w.browser==="firefox")}}]),s}(J),dr={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:""},mse:{code:2,msg:""},parse:{code:3,msg:""},format:{code:4,msg:""},decoder:{code:5,msg:""},runtime:{code:6,msg:""},timeout:{code:7,msg:""},other:{code:8,msg:""}},HAVE_NOTHING:"/",HAVE_METADATA:"/",HAVE_CURRENT_DATA:"/",HAVE_FUTURE_DATA:"",HAVE_ENOUGH_DATA:"",NETWORK_EMPTY:"/",NETWORK_IDLE:"/",NETWORK_LOADING:"",NETWORK_NO_SOURCE:"/",MEDIA_ERR_ABORTED:"",MEDIA_ERR_NETWORK:"",MEDIA_ERR_DECODE:"",MEDIA_ERR_SRC_NOT_SUPPORTED:"/",REPLAY:"",ERROR:"",PLAY_TIPS:"",PAUSE_TIPS:"",PLAYNEXT_TIPS:"",DOWNLOAD_TIPS:"",ROTATE_TIPS:"",RELOAD_TIPS:"",FULLSCREEN_TIPS:"",EXITFULLSCREEN_TIPS:"",CSSFULLSCREEN_TIPS:"",EXITCSSFULLSCREEN_TIPS:"",TEXTTRACK:"",PIP:"",SCREENSHOT:"",LIVE:"",OFF:"",OPEN:"",MINI_DRAG:"",MINISCREEN:"",REFRESH_TIPS:"",REFRESH:"",FORWARD:"",LIVE_TIP:""}},si=function(l){F(s,l);var o=M(s);function s(){var i;L(this,s);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i=o.call.apply(o,[this].concat(t)),k(C(i),"onGapJump",function(){var r=C(i),a=r.player,u=r.config;if(a.media.readyState!==HTMLMediaElement.HAVE_NOTHING){if(a.media.seeking){if(!i.seekingEventReceived)return}else i.seekingEventReceived=!1;if(!(a.media.paused&&a.media.currentTime!==0&&i.hasPlayed)){var c=a.media.buffered,h=u.smallGapLimit||.5,g=u.gapDetectionThreshold||.3,v=a.media.currentTime,d=i._getIndex(c,v,g);if(!(d===null||d===0)){console.log("GapJump  bufferRange ",c.start(d),c.end(d));var y=c.start(d)+.1,m=a.media.duration;if(!(y>m)){var _=y-v,T=_<=h;_<s.BROWSER_GAP_TOLERANCE||T&&(u.useGapJump!==!1&&(a.media.currentTime=i.isSafari?y+.1:y),i.player&&i.player.emit("detectGap"),console.log("gapJump gapIndex",d," isGapSamll:",T," currentTime:",a.media.currentTime," jumpSize:",v-a.media.currentTime),y!==.08&&a&&a.emit("log",{type:"oneevent",end_type:"gap",vid:a.config.vid,ext:{video_postion:Math.floor(y*1e3)}}))}}}}}),i}return A(s,[{key:"afterCreate",value:function(){var e=this,t=this.config.useGapJump;t!==!1&&(this.hasPlayed=!1,this.seekingEventReceived=!1,this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),this.on(st,this.onGapJump),this.on(fe,function(){e.hasPlayed=!0}),this.on(Kt,function(){e.seekingEventReceived=!0}))}},{key:"_getIndex",value:function(e,t,n){if(!e||!e.length||e.length===1&&e.end(0)-e.start(0)<1e-6)return null;for(var r=this._getBuffered(e),a=null,u=0;u<r.length;u++){var c=r[u];if(c.start>t&&(u===0||r[u-1].end-t<=n)){a=u;break}}return a}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}}],[{key:"pluginName",get:function(){return"gapJump"}},{key:"defaultConfig",get:function(){return{useGapJump:!1,smallGapLimit:.5,gapDetectionThreshold:.3}}}]),s}(J);si.BROWSER_GAP_TOLERANCE=.001;var gr=function(l){F(s,l);var o=M(s);function s(){var i;L(this,s);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i=o.call.apply(o,[this].concat(t)),k(C(i),"onWaiting",function(){var r=C(i),a=r.config;i.jumpCnt>a.jumpCntMax||i.timer||a.useWaitingTimeoutJump===!1||(i.timer=setTimeout(i.onJump,a.waitingTime*1e3))}),k(C(i),"onJump",function(){var r=C(i),a=r.player,u=r.config;if(clearTimeout(i.timer),i.timer=null,!(i.jumpCnt>u.jumpCntMax||u.useWaitingTimeoutJump===!1)&&!(a.media.paused&&a.media.currentTime!==0&&i.hasPlayed)){i.jumpSize=u.jumpSize*(i.jumpCnt+1),i.jumpCnt===u.jumpSize&&i.jumpSize<6&&(i.jumpSize=6);var c=a.currentTime+i.jumpSize,h=a.media.duration;c>h||(i.jumpCnt++,a.currentTime=c)}}),i}return A(s,[{key:"afterCreate",value:function(){var e=this,t=this.config,n=t.useWaitingTimeoutJump,r=t.jumpSize;n!==!1&&(this.hasPlayed=!1,this.jumpCnt=0,this.timer=null,this.jumpSize=r,this.on(st,this.onWaiting),this.on([Yi,Ee],function(){clearTimeout(e.timer),e.timer=null,e.jumpSize=e.config.jumpSize}),this.on(fe,function(){e.hasPlayed=!0}))}}],[{key:"pluginName",get:function(){return"waitingTimeoutJump"}},{key:"defaultConfig",get:function(){return{useWaitingTimeoutJump:!1,waitingTime:15,jumpSize:2,jumpCntMax:4}}}]),s}(J),vr=function(l){F(s,l);var o=M(s);function s(){return L(this,s),o.apply(this,arguments)}return A(s,[{key:"afterCreate",value:function(){var e=this,t=this.player,n=this.config,r=t.media||t.video;if(this.timer=null,this._lastDecodedFrames=0,this._currentStuckCount=0,this._lastCheckPoint=null,this._payload=[],!n.disabled){var a=r.getVideoPlaybackQuality;a&&(this.on(fe,function(){e._startTick()}),this.on(at,function(){e._stopTick()}),this.on(Ki,function(){e._stopTick()}),this.on(Xt,function(){e._stopTick()}))}}},{key:"_startTick",value:function(){var e=this;this._stopTick(),this._timer=setTimeout(function(){e._checkDecodeFPS(),e._startTick()},this.config.tick)}},{key:"_stopTick",value:function(){clearTimeout(this._timer),this._timer=null}},{key:"_checkBuffer",value:function(e,t){for(var n=!1,r=[],a=0;a<t.length;a++){var u=t.start(a),c=t.end(a);if(r.push({start:u,end:c}),u<=e&&e<=c-1){n=!0;break}}return{enoughBuffer:n,buffers:r}}},{key:"_checkStuck",value:function(e,t,n,r){var a=this.player.media||this.player.video,u=document.hidden,c=a.paused,h=a.readyState,g=a.currentTime,v=a.buffered;if(!(u||c||h<4)){var d=this._checkBuffer(g,v),y=d.enoughBuffer,m=d.buffers;y&&(e<=this.config.reportFrame?(this._currentStuckCount++,this._payload.push({currentTime:g,buffers:m,curDecodedFrames:e,totalVideoFrames:t,droppedVideoFrames:n,checkInterval:r}),this._currentStuckCount>=this.config.stuckCount&&(this.emit(Xi,this._payload),this._reset())):this._reset())}}},{key:"_reset",value:function(){this._payload=[],this._currentStuckCount=0}},{key:"_checkDecodeFPS",value:function(){var e=this.player.media||this.player.video;if(e){var t=e.getVideoPlaybackQuality(),n=t.totalVideoFrames,r=t.droppedVideoFrames,a=performance.now();if(n&&this._lastCheckPoint){var u=n-this._lastDecodedFrames,c=a-this._lastCheckPoint;this._checkStuck(u,n,r,c)}this._lastDecodedFrames=n,this._lastCheckPoint=a}}},{key:"destroy",value:function(){this._stopTick()}}],[{key:"pluginName",get:function(){return"FpsDetect"}},{key:"defaultConfig",get:function(){return{disabled:!1,tick:1e3,stuckCount:3,reportFrame:0}}}]),s}(J);Ce.use(dr);var pr=A(function l(o,s){var i,e,t;L(this,l);var n=s&&s.isMobileSimulateMode==="mobile",r=s.isLive,a=r?[]:[Kn,dn,gn,lr,vn],u=[].concat(a,[ln,cn,qn,Zn,ar,or,ir,nr,hn,fn]),c=[en,tn,nn,rn,sn,an,on,un,Yn];this.plugins=[qi,Ji].concat(ke(u),c,[si,gr]);var h=n?"mobile":w.device;switch(h){case"pc":(i=this.plugins).push.apply(i,[Ct,qe,kt,Qi,vr]);break;case"mobile":(e=this.plugins).push.apply(e,[Zi]);break;default:(t=this.plugins).push.apply(t,[Ct,qe,kt])}(w.os.isIpad||h==="pc")&&this.plugins.push(fr),w.os.isIpad&&this.plugins.push(qe),this.ignores=[],this.i18n=[]}),Q=function(l){F(s,l);var o=M(s);function s(){return L(this,s),o.apply(this,arguments)}return A(s)}(Le);k(Q,"defaultPreset",pr);k(Q,"Util",f);k(Q,"Sniffer",w);k(Q,"Errors",je);k(Q,"Events",pn);k(Q,"Plugin",J);k(Q,"BasePlugin",We);k(Q,"I18N",Ce);k(Q,"STATE_CLASS",p);k(Q,"InstManager",ti);const mr=()=>ht(void 0,null,function*(){Ci("XPlayer setup..."),Le.defaultPreset=_n}),yr=l=>{const o=K.useRef(null),s=K.useRef(null),{options:i}=l;return Te.useEffect(()=>{if(s.current){const e=s.current;e.autoplay(i.autoplay),e.src(i.sources)}else{mr().then();const e=mn({el:o.current,url:l.options.src},i);new Q(yn(e)),Ei(l.onReady)&&l.onReady()}},[i,o]),Te.useEffect(()=>{const e=s.current;return()=>{e&&!e.isDisposed()&&(e.dispose(),s.current=null)}},[s]),De.jsx("div",{children:De.jsx("div",{ref:o})})},kr=()=>{const l={src:"https://vjs.zencdn.net/v/oceans.mp4"};return De.jsx(Rn,{content:"elvea",zIndex:9999,children:De.jsx("div",{className:"m-auto mt-8",style:{width:500,height:300},children:De.jsx(yr,{options:l})})})};export{kr as default};
